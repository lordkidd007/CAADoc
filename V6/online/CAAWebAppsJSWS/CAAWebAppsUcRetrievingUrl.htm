<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
<meta http-equiv="Content-Language" content="en-us" />
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css"/>
<script type="text/javascript" src="../CAADocJavaScript/DSDocTocToc.js">/* */</script>
<script type="text/javascript" src="../CAADocJavaScript/DSDocHighlight.js">/* */</script>
<script type="text/javascript" src="../CAADocJavaScript/submit.js">/* */</script>
<title>Retrieving Service Url</title>
    
</head>
<body onload="highlightSearchTerms();">

<table class="DocHeader">
	<tr>
		<td class="DocHeader1">
		<h1><a name="Top"></a>Retrieving Service Url</h1>
		
		</td>
	</tr>
	<tr>
		<td class="use">Use Case</td>
	</tr>
</table>

<!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-comment-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<table class="abstract">
	<tr>
		<td>
		<h2>Abstract</h2>
		<p>This article displays the platform instances of the <b>3D</b>EXPERIENCE, and for each of them, the url of the services exposing Web service . 
		It is an illustration of the reference article [<a href="#References">1</a>] </p>
		<ul>
			<li><a href="#Learn">What You Will Learn With This Use Case</a></li>
			<li><a href="#UseCase">The CAAi3DXCompassServiceUrl Use Case</a>
			<ul>
				<li><a href="#What">What Does CAAi3DXCompassServiceUrl Do</a></li>
				<li><a href="#How">How to Launch CAAi3DXCompassServiceUrl</a></li>
				<li><a href="#Where">Where to Find the CAAi3DXCompassServiceUrl Code</a></li>
			</ul>
			</li>
			<li><a href="#Step">Step-by-Step</a></li>
			<li><a href="#InShort">In Short</a></li>
			<li><a href="#References">References</a></li>
		</ul>
		
		</td>
	</tr>
</table>
<!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-comment-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<h2><a name="Learn"></a>What You Will Learn With This Use Case</h2>
<p>In this article you will learn how to use the two functions exported by the <a href="#" onclick="CAAlink('JS', 'i3DXCompassUI', 'i3DXCompassServices', 'i3DXCompassServices'); return false;">DS/i3DXCompassServices/i3DXCompassServices</a> AMD  module [<a href="#References">2</a>].</p>
<script type="text/javascript">insertLinkToTop();</script>
<!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-comment-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<h2><a name="UseCase"></a>The CAAi3DXCompassServiceUrl Use Case</h2>
<p>CAAi3DXCompassServiceUrl is a use case of CAAi3DXCompassUI.edu framework.</p>
<script type="text/javascript">insertLinkToTop();</script>
<!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-comment-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<h3><a name="What"></a>What Does CAAi3DXCompassServiceUrl Do</h3>
<p>CAAi3DXCompassServiceUrl is a widget Apps calling the <i>getPlatformServices</i> and <i>getServiceUrl</i> functions exported by the 
<a href="#" onclick="CAAlink('JS', 'i3DXCompassUI', 'i3DXCompassServices', 'i3DXCompassServices'); return false;">DS/i3DXCompassServices/i3DXCompassServices</a> module.</p>
<p>The end-user can select through preferences the inputs of those APIs:</p>
<table>
 <caption><a name="Fig.1">Fig.1</a> User Preferences</caption>
	<tr>
		<td>
		<img alt="UserPreferences" src="images/CAAWebAppsUcWidgetPreferences.png"/></td>
	</tr>
</table>
<ul>
<li>The first - Platform instance identifier -  is valid for the two methods.</li>
<li>The second - Service name a combo with two values : 3DSwym, 3DPassport -  is valid for <i>getServiceUrl</i> method only. </li>
</ul>
<p>Let's see some widget body contents according the user preference values </p> 
<table>
 <caption><a name="Fig.2">Fig.2</a> Service Url for all Platforms</caption>
	<tr>
		<td>
		<img alt="UserPreferences" src="images/CAAWebAppsUcGetPlatformIdEmpty.png"/></td>
	</tr>
</table>
<p>Above the result, when platform instance is not set. All the platform instances are displayed.</p>

<table>
 <caption><a name="Fig.3">Fig.3</a> Service Url for one Platform instance</caption>
	<tr>
		<td>
		<img alt="UserPreferences" src="images/CAAWebAppsUcGetPlatformId.png"/></td>
	</tr>
</table>
<p>Above when one instance platform is selected (here DSDEV001). </p>

<table>
 <caption><a name="Fig.4">Fig.4</a> Result for a Wrong Platform Instance</caption>
	<tr>
		<td>
		<img alt="UserPreferences" src="images/CAAWebAppsUcGetPlatformIdError.png"/></td>
	</tr>
</table>
<p>Above when one instance platform is set with a wrong value.</p>
<script type="text/javascript">insertLinkToTop();</script>
<!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-comment-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<h3><a name="How"></a>How to Launch CAAi3DXCompassServiceUrl</h3>
<p>To launch CAAi3DXCompassServiceUrl, you will need to set up the build time environment, then compile CAAi3DXCompassServiceUrl along with its prerequisites, 
set up the run time environment, and then execute the use case [<a href="#References">3</a>]</p>
<script type="text/javascript">insertLinkToTop();</script>
<!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-comment-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<h3><a name="Where"></a>Where to Find the CAAi3DXCompassServiceUrl Code</h3>
<p>The CAAi3DXCompassServiceUrl use case is made of several files located in the  framework:</p>
    <ul>
        <li> <code>InstallRootFolder\CAADoc\CAAi3DXCompassUI.edu\CAAi3DXCompassServiceUrl.mweb\src\CAAi3DXCompassServiceUrl.html</code>, the widget html web page</li>
        <li> <code>InstallRootFolder\CAADoc\CAAi3DXCompassUI.edu\CAAi3DXCompassServiceUrl.mweb\src\CAAi3DXCompassMngt.js</code>, the external js file </li>
    </ul>
  <p>where InstallRootFolder [<a href="#References">3</a>] is the folder where the API CD-ROM is installed.</p> 
<script type="text/javascript">insertLinkToTop();</script>
<!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-comment-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<h2><a name="Step"></a>Step-by-Step</h2>
<p>There are several steps:</p>
 <ul>
 <li><a href="#Step1">Requiring AMD Modules</a></li>
 <li><a href="#Step2">Defining Widget Functions</a></li>
 <li><a href="#Step3">Calling getPlatformServices</a></li>
 <li><a href="#Step4">Calling getServiceUrl</a></li>
 <li><a href="#Step5">Displaying the result</a></li>
 <li><a href="#Step6">Decoding the getPlatformServices anwser</a></li>
 <li><a href="#Step7">Decoding the getServiceUrl anwser</a></li>
 </ul>
<script type="text/javascript">insertLinkToTop();</script>
<!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-comment-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<h3><a name="Step1"></a>Requiring AMD Modules</h3>
<p>The widget application uses functions exported by two AMD modules: the one we have created for the use case (CAAi3DXCompassMngt.js), and 
the one exporting the exposed API (i3DXCompassServices.js). </p>
<pre class="code">
&lt;script&gt;
    /* global require,widget */
   <b>require(['DS/i3DXCompassServices/i3DXCompassServices', 
            'DS/CAAi3DXCompassServiceUrl/CAAi3DXCompassMngt' ] </b>, function (i3DXCompassServices,CAAi3DXCompassMngt) {
      'use strict';
       See <a href="#Step2">Defining Widget Functions</a> section	
   });
&lt;/script&gt;   
</pre>
<p>You retrieve the pattern of the AMD module [<a href="#References">2</a>]. </p>
  <script type="text/javascript">insertLinkToTop();</script>
 <!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-comment-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<h3><a name="Step2"></a>Defining Widget Functions</h3>
<p>The widget defines two functiond <code>onLoad</code> and  <code>DataReady</code>:</p>
<pre class="code">
var MyWidget = {
   onLoad: function() {
      ...
   },
   DataReady: function() {
      ...
   }
};
widget.addEvent('onLoad', MyWidget.onLoad);		
</pre>
<ul>
<li><code>onLoad</code>: The function invoked when the widget is launched, or refreshed - ( we don't have used onRefresh event). It invokes the 
i3DXCompassServices service.</li>
<li><code>DataReady</code>: the function invoked when the <i>i3DXCompassServices</i> service calls are onComplete status.</li>
</ul>
  <script type="text/javascript">insertLinkToTop();</script>
 <!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-comment-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<h3><a name="Step3"></a>Calling getPlatformServices</h3>
<p>This method is called by the Onload callback.</p>
<pre class="code">
if ( widget.getValue('PlatFormInstanceId') === "" ) {
   i3DXCompassServices.<b>getPlatformServices</b>( { 
        <b>onComplete</b>  : function ( data ) {
            CAAi3DXCompassMngt.setPlatformServices(data);
            MyWidget.DataReady() ;
		},
        <b>onFailure</b>:  function(error) { 
            console.warn('Failure:', error); 
        }
    } ) ;
    ...
} else {
    i3DXCompassServices.<b>getPlatformServices</b>( { 
        <b>platformId</b>  : widget.getValue('PlatFormInstanceId'),
        <b>onComplete</b>  : function ( data ) {
            CAAi3DXCompassMngt.setPlatformServices(data);
            MyWidget.DataReady() ;
        },
        <b>onFailure</b>:  function(error) { 
            console.warn('Failure:', error); 
        }
    });
    ...
}	
</pre>
<p><code>i3DXCompassServices</code> represents the <code>'DS/i3DXCompassServices/i3DXCompassServices' </code> AMD 
module [<a href="#References">2</a>] see step <a href="#Step1">Requiring AMD Modules</a>. </p>
<p>The <i>getPlatformServices</i> method is called with an object (JSON structure) as argument: at least two functions (onComplete, onFailure) and with
the platform instance id if the value is defined by the preference.</p>
 <p>The anonymous function called when the <i>getPlatformServices</i> method has obtained the result, consists in,  first to store the result (data) 
 in one data of our AMD module (CAAi3DXCompassMngt), and then to analyse the answer for a display in the widget's body  (DataReady function).</p>

 <script type="text/javascript">insertLinkToTop();</script>
 <!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-comment-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
 
<h3><a name="Step4"></a>Calling getServiceUrl</h3>
<p>This method is called by the onLoad callback.</p>
<pre class="code">
if ( widget.getValue('PlatFormInstanceId') === "" ) {
   ...
   <b>i3DXCompassServices.getServiceUrl </b>( { 
      <b>serviceName</b>: widget.getValue('ServiceName'),
      <b>onComplete</b> : function ( data ) {
          CAAi3DXCompassMngt.setServiceUrl(data);
          MyWidget.DataReady() ;
      },
      <b>onFailure</b>:  function(error) { 
          console.warn('Failure:', error); 
      }	
   } ) ;   
} else {
   ...
   <b>i3DXCompassServices.getServiceUrl </b>( { 
      <b>serviceName</b>: widget.getValue('ServiceName'),
      <b>platformId</b> : widget.getValue('PlatFormInstanceId'),	  
      <b>onComplete</b> : function ( data ) {
           CAAi3DXCompassMngt.setServiceUrl(data);
           MyWidget.DataReady() ;
      },
      <b>onFailure</b>:  function(error) { 
           console.warn('Failure:', error); 
      }	
   } ) ;      
   ...
}	
</pre>
<p><code>i3DXCompassServices</code> represents the <code>'DS/i3DXCompassServices/i3DXCompassServices' </code> AMD 
module [<a href="#References">2</a>] see step <a href="#Step1">Requiring AMD Modules</a>. </p>
<p>The <i>getServiceUrl</i> method is called with an object (JSON structure) as argument. There are at least three
key/value elements: the name of the service, and the callbacks to receive the answer. When the text editor of the "Platform instance identifier"
 is not empty - <a href="#Fig.1">Fig.1</a> - the platform instance identifier (platformId) is added too. </p>
 <p>The anonymous function called when the <i>getPlatformServices</i> method has obtained the result, consists in,  first to store the result (data) 
 in one data of our AMD module (CAAi3DXCompassMngt), and then to analyse the answer for a display in the widget's body  (DataReady function).</p>
 <script type="text/javascript">insertLinkToTop();</script>
 <!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-comment-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<h3><a name="Step5"></a>Displaying the result</h3>
<p>When the result for <i>getServiceUrl</i> or <i>getPlatformServices</i> is successfully returned, the "DataReady" function is called.</p>
<pre class="code">
<b>DataReady</b>: function() {
    var service = widget.getValue('ServiceName') ; 
    var platformId = widget.getValue('PlatFormInstanceId') ; 
    var ServiceStr= CAAi3DXCompassMngt.GetTextForgetServiceUrl(service) ; 
    var PlatformStr= CAAi3DXCompassMngt.GetTextForgetPlatformServices(platformId) ; 
						
    <b>widget.body.innerHTML</b>= PlatformStr + '&lt;/br&gt;' + ServiceStr  ;	
}
</pre>
<p>The function requests the text to display from the CAAi3DXCompassMngt AMD module. </p>
<p>This part of code is called twice (the same function is called when  <i>getPlatformServices</i> and 
<i>getServiceUrl</i> are complete). To manage the asynchonysum, at the beginning of the onLoad method, we invalidate the data stored in
the CAAi3DXCompassMngt AMD module </p>
<pre class="code">
onLoad: function() {
   CAAi3DXCompassMngt.<b>unValidData</b>();
   ...
}
</pre>
<p>This method sets to to nul the private data</p>
<script type="text/javascript">insertLinkToTop();</script>
<!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-comment-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<h3><a name="Step6"></a>Decoding getPlatformServices answer</h3>
 <p>Here the method <i>getTextForgetPlatformServices</i> exported by the CAAi3DXCompassMngt AMD Module:</p>
<pre class="code">
<b>getTextForgetPlatformServices </b> : function ( platformid  ) {
    var text="Information from getPlatformServices" + '&lt;/br&gt;' ;

    if ( <b>datafromgetPlatformServices === null </b>)  {
       text = text + "Still not returned" ;
    }else {

       if ( <b>typeof datafromgetPlatformServices === "undefined"  </b>) {
          text = text + 'error with the platform instance' ;
       }else {	
          if ( platformid	=== "" ) {	   
              <b>datafromgetPlatformServices.forEach(function (platform )</b> {
                  text = text + 'platformId: ' + platform['<b>platformId</b>'] + '&lt;br&gt;' ; 
                  text = text + '   displayName: ' + platform['<b>displayName</b>'] + '&lt;br&gt;' ;
                  text = text + '   3DPassport: '  + platform['<b>3DPassport</b>'] + '&lt;br&gt;' ;
                  text = text + '   3DSwym: '      + platform['<b>3DSwym</b>'] + '&lt;br&gt;&lt;br&gt;' ; 
              } );	
          }else {
              text = text + 'platformId: ' + platformid + '&lt;br&gt;' ; 
              text = text + '   displayName: ' + datafromgetPlatformServices['displayName'] + '&lt;br&gt;' ; 
              text = text + '   3DPassport: '  + datafromgetPlatformServices['3DPassport'] + '&lt;br&gt;' ; 
              text = text + '   3DSwym: '      + datafromgetPlatformServices['3DSwym'] + '&lt;br&gt;&lt;br&gt;' ; 
          }		  
       }
    }
    return text;
}
</pre>
<p><code>datafromgetPlatformServices</code> is the value stored by the AMD module- See step <a href="#Step3" >Calling getPlatformServices</a>. The argument of the 
function, <code>platformid</code>, is the current preference value.</p>
<p>From top-down code:</p>
<ul>
<li><code>datafromgetPlatformServices</code> is null while <i>getPlatformServices</i> has still not answered.  </li>
<li><code>datafromgetPlatformServices</code> is undefined when the platform instance used for <i>getPlatformServices</i> is wrong. See [<a href="#Fig.4">Fig.4</a>]. </li>
<li><code>datafromgetPlatformServices</code> is an array of a JSON structures when no platform instance as input of <i>getPlatformServices</i> . See [<a href="#Fig.2">Fig.2</a>]. </li>
<li><code>datafromgetPlatformServices</code> is a JSON structure when a platform instance has been specified as input of <i>getPlatformServices</i>. See [<a href="#Fig.3">Fig.3</a>]. </li>
</ul>
<script type="text/javascript">insertLinkToTop();</script>
<!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-comment-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<h3><a name="Step7"></a>Decoding getServiceUrl answer</h3>
<p>Here the method <i>GetTextForgetServiceUrl</i> exported by the CAAi3DXCompassMngt AMD Module:</p>
<pre class="code">
<b>GetTextForgetServiceUrl  </b>: function ( servicename ) {
    var text="<b>Information from getServiceUrl</b> for " + servicename +  "&lt;/br&gt;" ;
			 
    if ( datafromgetServiceUrl === null ) {
       text = text + "Still not returned" ;
    }else {
       if ( <b>typeof  datafromgetServiceUrl === "undefined" </b>) {
          text = text + 'error with the service name or platform instance ' ;
       }else if ( <b>typeof datafromgetServiceUrl === "string" </b>) {
          text = text + 'url:' + datafromgetServiceUrl  ;
       }else {
          datafromgetServiceUrl.forEach(function (service) {
             text = text + 'platformId: ' + service['<b>platformId</b>'] + '&lt;br&gt;' ; 
             text = text + 'url:'         + service['<b>url</b>'] + '&lt;br&gt;&lt;br&gt;' ; 
          } );
          text = text + "&lt;br&gt;";
        }
    }  
    return text;
}
</pre>
<p><code>datafromgetServiceUrl</code> is the value stored by the AMD module- See step 
<a href="#Step4" >Calling getServiceUrl</a>. The argument of the function, <code>servicename</code>, is the current preference value.</p>
<p>From top-down code:</p>

<ul>
<li><code>datafromgetServiceUrl</code> is null while the <i>getServiceUrl</i> has still not answered.   </li>
<li><code>datafromgetServiceUrl</code> is undefined when the platform instance used for <i>getServiceUrl</i> is wrong. See [<a href="#Fig.4">Fig.4</a>]. </li>
<li><code>datafromgetServiceUrl</code> is a string when a platform instance  has been specified for <i>getServiceUrl</i>. See [<a href="#Fig.3">Fig.3</a>]. </li>
<li><code>datafromgetServiceUrl</code> is an array when there is no platform instance for <i>getServiceUrl</i>. See [<a href="#Fig.2">Fig.2</a>]. </li>
</ul>

<script type="text/javascript">insertLinkToTop();</script>
<!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-comment-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<h2><a name="InShort"></a>In Short</h2>
<p>This use case shows how to call the API, to manage the asynchronous result, and how to decode the result. </p>
<script type="text/javascript">insertLinkToTop();</script>
<!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-comment-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<h2><a name="References"></a>References</h2>
<table class="reference">
    
	<tr>
		<td>[1]</td>
		<td><a href="CAAWebAppsTaServicePlatform.htm">About Service Url and Platform Instance</a></td>
	</tr>
    <tr>
		<td>[2]</td>
		<td><a href="../CAAWebAppsJSGuides/CAAWebAppsTaAMDConcepts.htm">AMD Concepts</a></td>
	</tr>
	<tr>
		<td>[3]</td>
		<td>Building and Launching a Web App Use Case</a></td>
	</tr>
	
  
</table>
<script type="text/javascript">insertLinkToTop();</script>
<!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-comment-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<h2><a name="History"></a>History</h2>
<table class="history">
	<tr>
		<td>Version: <strong>1</strong> [August 2014]</td>
		<td>Document created</td>
	</tr>
</table>
<script type="text/javascript">insertLinkToTop();</script>
<!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-comment-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<script type="text/javascript">insertCopyright();</script>

</body>

</html>
