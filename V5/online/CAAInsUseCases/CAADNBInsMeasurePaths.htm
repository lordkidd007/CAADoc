<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
<title>Creating and Measuring Activities</title>
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>Inspection Process Definition</h1>
    </td>
    <td valign="top">
      <h2>Inspection</h2>
    </td>
    <td rowspan="2" align="right" valign="top">
      <h3><a name="Top"></a>Creating and Measuring Activities</h3>
      <em>Creating a measured path activity</em></td>
  </tr>
  <tr>
    <td class="use" colspan="2">Use Case</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      <p>This article discusses the CAADNBInsMeasActivities use case. This use
      case explains how to create a CATProcess in a Batch Mode , to add features
      to it and then to measure them .
      <ul>
        <li><strong><a href="#Learn">What You Will Learn With This Use Case</a></strong></li>
        <li><strong><a href="#UseCase">The CAADNBInsMeaActivities Use Case</a></strong>
          <ul>
            <li><a href="#What">What Does CAADNBInsMeasActivities Do</a>
            <li><a href="#How">How to Launch CAADNBInsMeasActivities</a></li>
            <li><a href="#Where">Where to Find the CAADNBInsMeasActivities Code</a>
          </ul>
        <li><strong><a href="#Step">Step-by-Step</a></strong></li>
        <li><strong><a href="#In Short">In Short</a></strong></li>
      </ul>
    </td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
<p>This use case is intended to help you create a Process document, create
features and activities, and then measure these activities.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="UseCase"></a>The CAADNBInsMeasActivities Use Case</h3>
<p>CAADNBInsMeasActivities is a use case of the CAADNBInsMeasPaths.m module in
the CAADNBInspectInterfaces.edu framework that illustrates
CAADNBInspectInterfaces framework capabilities.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="What"></a>What Does CAADNBInsMeasActivities Do</h4>
<p>CAADNBInsMeasActivities is a main program (a batch mode application). First,
it creates a Process document named Experiment.CATProcess, and then it creates
two activities, namely a DefineSphere and a DefinePlane activity. Then it
measures both activites and creates a path for them. Finally, it saves the
Process document.</p>
<table border="0">
  <caption>The Experiment.CATProcess Document</caption>
  <tr>
    <td>
      <pre><img border="0" src="images/CAAInsMeasPaths.gif" width="864" height="559"></pre>
    </td>
  </tr>
</table>
<table border="0" width="100%">
  <caption>&nbsp;</caption>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="How"></a>How to Launch CAADNBInsMeasActivities</h4>
<p>To launch CAADNBInsMeasActivities , you will need to set up the build time
environment, then compile CAADNBInsMeasActivities along with its prerequisites,
set up the run time environment, and then execute the use case [<a href="#References">1</a>].</p>
<p>Launch the use case as follows:</p>
<ul>
  <li>With Windows
    <table class="code">
      <tr>
        <td>
          <pre>d:&gt;<code>CAADNBInsMeasPaths&nbsp;</code></pre>
        </td>
      </tr>
    </table>
  <li>With UNIX
    <table class="code">
      <tr>
        <td>
          <pre>$ <code>CAADNBInsMeasPaths</code></pre>
        </td>
      </tr>
    </table>
  </li>
</ul>
<p>where <code>CAADNBInsMeasPaths</code> is the module which contains the use
case.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Where"></a>Where to Find the CAADNBInsMeasActivities Code</h4>
<p>The CAADNBInsMeasActivities use case is located in the CAADNBInsMeasPaths.m
module of the CAADNBInspectInterfaces.edu framework:</p>
<table>
  <tr>
    <td>Windows</td>
    <td><code>InstallRootDirectory\CAADNBInspectInterfaces.edu\CAADNBInsMeasPaths.m\</code></td>
  </tr>
  <tr>
    <td>Unix</td>
    <td><code>InstallRootDirectory/CAADNBInspectInterfaces.edu/CAADNBInsMeasPaths.m/</code></td>
  </tr>
</table>
<p>where <code>InstallRootDirectory</code> is the directory where the CAA CD-ROM
is installed.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="Step"></a>Step-by-Step</h3>
<p>Following are the logical steps in CAADNBInsMeasActivities:
<ol>
  <li><a href="#Creating a CATProcess">Creating and Initializing a Process
    Document</a>
  <li><a href="#Handler to DNBIInsFtrFactory Interface">Retrieving the Handler
    to the DNBIInsFtrFactory Interface</a>
  <li><a href="#Handler to DNBIInsActivitiesFactory Interface">Retrieving the
    Handler to the DNBIInsActivitiesFactory Interface</a>
  <li><a href="#Activity Root">Retrieving the Activity Root</a>
  <li><a href="#Creating a Sphere">Creating a Sphere Feature and a DefineSphere
    Activity</a>
  <li><a href="#Creating a Plane">Creating a Plane Feature and a DefinePlane
    Activity</a>
  <li><a href="#Measuring the DefinePlane Activity">Measuring the DefinePlane
    Activity</a>
  <li><a href="#Measuring the DefineSphere Activity">Measuring the DefineSphere
    Activity</a></li>
  <li><a href="#Saving the CATProcess">Saving the Process Document</a></li>
</ol>
<p>We will now comment each of these sections by looking at the code.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Creating a CATProcess"></a>Creating and Initializing a Process
Document</h4>
<table class="code">
  <tr>
    <td>
      <pre>//=============================================================================
//  Initialize : This method creates a New CATProcess
//               and intialize the current document
//=============================================================================
HRESULT
CAADNBInsServices::Initialize( CATDocument **INSLibDoc )
{
    HRESULT rc = E_FAIL;
  //----------------------------------------------------------------------
  // Initialize
  //----------------------------------------------------------------------
  cout &lt;&lt; endl;
  cout &lt;&lt; &quot;################################################&quot; &lt;&lt; endl;
  cout &lt;&lt; &quot;#    Creating a CATProcess                     #&quot; &lt;&lt; endl;
  cout &lt;&lt; &quot;################################################&quot; &lt;&lt; endl;
  cout &lt;&lt; endl;
  
  //----------------------------------------------------------------------
  // Create a New CATProcess
  //----------------------------------------------------------------------
  rc = CATDocumentServices::New( &quot;CATProcess&quot;,*INSLibDoc );
  if( *INSLibDoc == NULL )
    return( E_FAIL ) ;
  
  // Get a Handler to the BasicServices ,return if NULL_var
  DNBIInsBasicServices_var spInsServ( *INSLibDoc );
  if( NULL_var == spInsServ )
    return( E_FAIL ) ;
  
  // Set the Current Document
  rc = spInsServ-&gt;SetCurrentDocument( *INSLibDoc );
  return( S_OK );
}</pre>
    </td>
  </tr>
</table>
<p>A new Process document is created. The input argument in this method is a
pointer to the <i>CATDocument</i> class. This is a handler to the current
document. This method returns a HRESULT value. This method can be found in
CAADNBInsServ.cpp.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Handler to DNBIInsFtrFactory Interface"></a>Retrieving the Handler
to the DNBIInsFtrFactory Interface</h4>
<table class="code">
  <tr>
    <td>
      <pre>//=============================================================================
//  GetFtrFactory : This method gets the Current Document and returns the
//                  handler to the DNBIInsFtrFactory Interface
//=============================================================================
DNBIInsFtrFactory_var 
CAADNBInsServices::GetFtrFactory( CATDocument *INSLibDoc )
{
  HRESULT rc = E_FAIL;
  CATIContainer_var insCont = NULL_var;
  
  // Get a Handler to the BasicServices ,return if NULL_var
  DNBIInsBasicServices_var spInsServ ( INSLibDoc );
  if( NULL_var == spInsServ )
    return( NULL_var );
  
  // Get Inspect Container
  rc = spInsServ-&gt;GetInspectContainer( insCont, INSLibDoc );
  if ( NULL_var == insCont )
    return( NULL_var );


  // Handler to the DNBIInsFtrFactory
  DNBIInsFtrFactory_var ftrFact( insCont );
  if( NULL_var == ftrFact )
    return( NULL_var );
  
  return( ftrFact );
}</pre>
    </td>
  </tr>
</table>
<p>The <code>GetFtrFactory</code> method is used to get the handler to the <i>DNBIInsFtrFactory</i>
Interface. It takes an argument which is the current document. It gets the
handler to the <i>DNBIInsBasicServices</i> and then it gets the Inspect
Container. This method can be found in CAADNBInsServ.cpp.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Handler to DNBIInsActivitiesFactory Interface"></a>Retrieving the
Handler to the DNBIInsActivitiesFactory Interface</h4>
<table class="code">
  <tr>
    <td>
      <pre>//=============================================================================
//  GetActivityFactory : This method gets the InsertActivity and returns the
//                       handler to the DNBIInsActivitiesFactory Interface
//=============================================================================
DNBIInsActivitiesFactory_var
CAADNBInsServices::GetActivityFactory( CATISPPChildManagement_var InsertActivity )
{
  DNBIInsActivitiesFactory_var ActFact( InsertActivity );
  return( ActFact );
}</pre>
    </td>
  </tr>
</table>
<p>The <code>GetActivityFactory</code> method is used to get the handler to the <i>DNBIInsActivitesFactory</i>
Interface. It takes an argument which is the object of type <i>CATISPPChildManagement</i>
class. This method can be found in CAADNBInsServ.cpp.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Activity Root"></a>Retrieving the Activity Root</h4>
<table class="code">
  <tr>
    <td>
      <pre>//=============================================================================
//  GetActivityRoot : This method gets the the Current Document and returns the
//                    insertion point where new activity needs to be added
//                    In the first case its the fatherActivity
//=============================================================================
HRESULT
CAADNBInsServices::GetActivityRoot( CATISPPChildManagement_var &amp;InsertActivity ,
                                    CATDocument **INSLibDoc )
{
  CATInit_var INSLibDocInit( *INSLibDoc );
  
  // Process Container return if NULL_var
  CATISPPProcessContainer_var ProcessContainer =
                              INSLibDocInit-&gt;GetRootContainer(
                              CATISPPProcessContainer::ClassName() );
  if( NULL_var == ProcessContainer )
    return( E_FAIL );
  
  // List Of Processes
  CATListValCATBaseUnknown_var *listOfProcesses =
                                ProcessContainer-&gt;GetAllProcess();
  if( NULL == listOfProcesses )
    return( E_FAIL );
  
  // Activity Root
  CATISPPActivityRoot_var spActivityRoot = ( *listOfProcesses )[1];
  if( NULL_var == spActivityRoot )
    return( E_FAIL );
  
  // Get the Insert Activity , New Features will be added to the insert activity
  InsertActivity =  spActivityRoot;
  return( S_OK );
}</pre>
    </td>
  </tr>
</table>
<p>The <code>GetActivityRoot</code> method is used to get the Activity Root. It
takes two arguments, one of which is the object of type <i>CATISPPChildManagement</i>
interface, and the other one is of type <i>CATDocument</i> class (the current
document). This method can be found in CAADNBInsServ.cpp.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Creating a Sphere"></a>Creating a Sphere Feature and a DefineSphere
Activity</h4>
<table class="code">
  <tr>
    <td>
      <pre>//=============================================================================
//  CreateSphere : This method gets the InsertActivity ,creates a SphereFeature
//                 creates a SphereActivity,sets the SphereItem to the Activity
//                 list and returns the handler to the Sphere
//=============================================================================
DNBIInsSphere
*CreateSphere( CATDocument *INSLibDoc,
               CATISPPChildManagement_var &amp;InsertActivity )
{
  HRESULT rc = E_FAIL ;
  
  DNBIInsFtrFactory_var ftrFact = NULL_var;
  DNBIInsActivitiesFactory_var ActFact = NULL_var ;
  
  // Get the handler to the feature factory
  ftrFact = CAADNBInsServices::GetFtrFactory( INSLibDoc );

  // Get the handler to the Activity factory
  ActFact = CAADNBInsServices::GetActivityFactory( InsertActivity );
  
  // Return if the Handler to the FtrFactory or ActivitiesFactory is NULL_var
	if( NULL_var == ftrFact || NULL_var == ActFact )
		return( NULL );

  CATISpecObject_var spObj = NULL_var;
  CATBaseUnknown_var spIDefineSphere = NULL_var;
  
  //----------------------------------------------------------------------
  //  Create Sphere Feature
  //----------------------------------------------------------------------
  rc = ftrFact-&gt;CreateSphere( spObj );
  if( NULL_var == spObj )
  return( NULL );

  // Get the Handler to the Sphere
  DNBIInsSphere *spSphere = NULL;
  rc = spObj-&gt;QueryInterface( IID_DNBIInsSphere,( void ** )&amp;spSphere );
  if( FAILED( rc ) )
    return( NULL );
  
  CATMathVector Vec( 20.00,-30.00,0 );
  CATMathTransformation objPos;
  objPos.SetVector(Vec);

  // Set Sphere Parameters
  spSphere-&gt;SetDiameter( 30.00 );
  spSphere-&gt;SetPosition( objPos );

  //----------------------------------------------------------------------
  //  Create Sphere Activity
  //----------------------------------------------------------------------
  spIDefineSphere = ActFact-&gt;Create( InsertActivity,&quot;DefineSphere&quot; );
  
  // Set the Item
  CATISPPItemMgt_var spItm ( spIDefineSphere );
  if( NULL_var == spItm )
   return( NULL );
  spItm-&gt;AddItem( spSphere );

  // Set the InsertActivity(Insertion Point) as the New Activity
  InsertActivity = spIDefineSphere ;
  return( spSphere );
}</pre>
    </td>
  </tr>
</table>
<p>The <code>CreateSphere</code> method is used from the feature factory to
create the Sphere feature. The parameters are set for the Sphere and then the
DefineSphere activity is created using the <code>Create</code> method from the
activity factory. At the end the item is added to the tree using the <code>AddItem</code>
method.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Creating a Plane"></a>Creating a Plane Feature and a DefinePlane
Activity</h4>
<table class="code">
  <tr>
    <td>
      <pre>//=============================================================================
//  CreatePlane : This method gets the InsertActivity , creates a PlaneFeature,
//                creates a PlaneActivity ,Sets the PlaneItem to the Activity 
//                List and returns a handler to the Plane
//=============================================================================
DNBIInsPlane
*CreatePlane( CATDocument *INSLibDoc,
              CATISPPChildManagement_var &amp;InsertActivity )
{
  HRESULT rc = E_FAIL ;

  DNBIInsFtrFactory_var ftrFact = NULL_var;
  DNBIInsActivitiesFactory_var ActFact = NULL_var ;
  
  // Get the handler to the feature factory
  ftrFact = CAADNBInsServices::GetFtrFactory( INSLibDoc );

  // Get the handler to the Activity factory
  ActFact = CAADNBInsServices::GetActivityFactory( InsertActivity );

  // Return if the Handler to the FtrFactory or ActivitiesFactory is NULL_var
	if( NULL_var == ftrFact || NULL_var == ActFact )
		return( NULL );
	
  CATISpecObject_var spObj = NULL_var;
  CATBaseUnknown_var spIDefinePlane = NULL_var;
  
  //----------------------------------------------------------------------
  //  Create Plane Feature
  //----------------------------------------------------------------------
  rc = ftrFact-&gt;CreatePlane( spObj );
  if( NULL_var == spObj )
  return( NULL );

  // Get the Handler to the Plane
  DNBIInsPlane *spPlane = NULL;
  rc = spObj-&gt;QueryInterface( IID_DNBIInsPlane,( void ** )&amp;spPlane );
  if( FAILED( rc ) )
    return( NULL );
  
  
  CATMathVector Vec(-20.00,35.00,0);
  CATMathTransformation objPos;
  objPos.SetVector(Vec);
  
  // Set Plane Parameters
  spPlane-&gt;SetLength(40.00);
  spPlane-&gt;SetWidth(40.00);
  spPlane-&gt;SetPosition(objPos);
  
  //----------------------------------------------------------------------
  //  Create Plane Activity
  //----------------------------------------------------------------------
  spIDefinePlane = ActFact-&gt;Create( InsertActivity,&quot;DefinePlane&quot; );
  
  // Set the Item
  CATISPPItemMgt_var spItm ( spIDefinePlane );
  if( NULL_var == spItm )
   return( NULL );
  spItm-&gt;AddItem( spPlane );

  // Set the InsertActivity(Insertion Point) as the New Activity
  InsertActivity = spIDefinePlane ;
  return( spPlane );
}</pre>
    </td>
  </tr>
</table>
<p>The <code>CreatePlane</code> method is used from the feature factory to
create the Plane feature. The parameters are set for the Plane and then the
DefinePlane activity is created using the <code>Create</code> method from the
activity factory. At the end the item is added to the tree using the <code>AddItem</code>
method. It is similar to the <code>CreateLine</code> and <code>CreateSphere</code>
method.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Measuring the DefinePlane Activity"></a>Measuring the DefinePlane
Activity</h4>
<table class="code">
  <tr>
    <td>
      <pre>//-----------------------------------------------------------------------------
//  MeasurePlane : To Measure a Plane
//-----------------------------------------------------------------------------
HRESULT
MeasurePlane( DNBIInsPlane  *objPlane ,
              CATDocument* INSLibDoc ,
              CATISPPChildManagement_var &amp;InsertActivity )
{
  HRESULT rc = E_FAIL;
  
  DNBIInsMPathFactory_var spIMPathFactory = NULL_var;
  // Check if the Plane Element or spIMPathFactory is not NULL_var
  if( NULL_var == objPlane )
    return( E_FAIL );
  
  // Get the handler to the DNBIInsFeature Interface
  DNBIInsFeature_var spIFeature( objPlane );
  if( NULL_var == spIFeature ) 
    return( E_FAIL );
  
  CATBSTR bstrMPathName;
  CATUnicodeString MPathName;
  CATUnicodeString pathType;
  CATBaseUnknown_var NewOp = NULL_var ;
  CATIContainer_var Cont = NULL_var;
  
  pathType = &quot;DNBInsPlaneFtrPath&quot;;
  MPathName.Append( &quot;PlanePath&quot; );
  MPathName.ConvertToBSTR( &amp;bstrMPathName );
  DNBIInsMPath *pIMPath=NULL;
  
  // Get a Handler to the BasicServices ,return if NULL_var
  DNBIInsBasicServices_var InsServ( INSLibDoc );
  if ( NULL_var == InsServ )
    return( E_FAIL );

  // Get MPathContainer
  spIMPathFactory = InsServ-&gt;GetMPathContainer();

  // Create MPath for the Given PathType
  spIMPathFactory-&gt;CreateMPath( bstrMPathName,
    pathType,
    pIMPath );
  ::CATFreeString( bstrMPathName );
  
  // return if the path created is Null
  if( NULL == pIMPath )
    return( E_FAIL );
  
  // To set the feature in the created path
  pIMPath-&gt;SetFeature( spIFeature );
  
  // Get Inspect Container
  rc = InsServ-&gt;GetInspectContainer( Cont, INSLibDoc );
  if ( NULL_var == Cont )
    return( E_FAIL );
    
  //----------------------------------------------------------------------
  // Apply rules to modify the path parameters according to the feature
  //----------------------------------------------------------------------
   DNBIInsKWFactory_var spIRuleFact( Cont );

  CATIRuleBase_var spIRuleBase = spIRuleFact-&gt;GetRuleBase();
  if( spIRuleBase != NULL_var )
  {
    CATISpecObject_var spISpecPath( pIMPath );
    CATISpecObject_var spISpecFtr( spIFeature );
    spIRuleFact-&gt;AddKWInstance( spISpecFtr );
    spIRuleFact-&gt;AddKWInstance( spISpecPath );
    spIRuleBase-&gt;Solve( 1 );
  }
  else
  {
    DNBIInsFtrPathRules_var spIRules ( pIMPath );
    spIRules-&gt;SetRules();
  }
  
  //----------------------------------------------------------------------
  // To get the smart pointer to the given path
  // This is done because the AcquiredFeature takes only the Smart Pointer
  //----------------------------------------------------------------------
  DNBIInsMPath_var spIMPath = pIMPath ;
  if( NULL_var == spIMPath )
    return( E_FAIL );
  
  pIMPath-&gt;Release();
  pIMPath = NULL;

  DNBIInsFeature   *Feat;
  spIMPath-&gt;GetFeature( Feat );
  if( NULL == Feat )
   return( E_FAIL );

  // Get the handler to the ActivitiesFactory
  DNBIInsActivitiesFactory_var ActFact = NULL_var ;
  ActFact = CAADNBInsServices::GetActivityFactory( InsertActivity );

  // Create a MeasureActivity
  NewOp = ActFact-&gt;Create( InsertActivity,&quot;MeasurePlane&quot; );
  
  CATISPPItemMgt_var spItm ( NewOp );
  if( NULL_var == spItm )
   return( NULL );

  // SetItem for the Plane feature in the Measure Feature
  spItm-&gt;AddItem( Feat );
  Feat-&gt;Release();
  Feat = NULL ;
  
  // SetItem for the Path in the Measure Feature
  spItm-&gt;AddItem( spIMPath );
  InsertActivity = NewOp ;
  
  return( S_OK );
}</pre>
    </td>
  </tr>
</table>
<p>The <code>MeasurePlane</code> method gets the handler to the Plane feature
which needs to be measured. It&nbsp; creates a path for that and then it applies
rules to it. Finally it creates a MeasurePlane activity and adds it to the
Activity list.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Measuring the DefineSphere Activity"></a>Measuring the DefineSphere
Activity</h4>
<table class="code">
  <tr>
    <td>
      <pre>//-----------------------------------------------------------------------------
//  MeasureSphere : To Measure a Sphere
//-----------------------------------------------------------------------------
HRESULT
MeasureSphere( DNBIInsSphere  *objSphere ,
               CATDocument* INSLibDoc ,
               CATISPPChildManagement_var &amp;InsertActivity )
{
 
  HRESULT rc = E_FAIL;
  DNBIInsMPathFactory_var spIMPathFactory = NULL_var;

  // Check if the Sphere Element or spIMPathFactory is not NULL_var
  if( NULL_var == objSphere )
    return( E_FAIL );
  
  // Get the handler to the DNBIInsFeature Interface
  DNBIInsFeature_var spIFeature( objSphere );
  if( NULL_var == spIFeature ) 
    return( E_FAIL );
  

  CATBSTR bstrMPathName;
  CATUnicodeString MPathName;
  CATUnicodeString pathType;
  CATBaseUnknown_var NewOp = NULL_var;
  CATIContainer_var Cont = NULL_var;
  
  pathType = &quot;DNBInsSphereFtrPath&quot;;
  MPathName.Append( &quot;SpherePath&quot; );
  MPathName.ConvertToBSTR( &amp;bstrMPathName );
  DNBIInsMPath *pIMPath=NULL;
  
  // Get a Handler to the BasicServices ,return if NULL_var
  DNBIInsBasicServices_var InsServ( INSLibDoc );
  if ( NULL_var == InsServ )
    return( E_FAIL );

  // Get MPathContainer
  spIMPathFactory = InsServ-&gt;GetMPathContainer();

  // Create MPath for the Given PathType
  spIMPathFactory-&gt;CreateMPath( bstrMPathName,
    pathType,
    pIMPath );
  ::CATFreeString( bstrMPathName );
  
  // return if the path created is Null
  if( NULL == pIMPath )
    return( E_FAIL );
  
  // To set the feature in the created path
  pIMPath-&gt;SetFeature( spIFeature );

  // Get Inspect Container
  rc = InsServ-&gt;GetInspectContainer( Cont, INSLibDoc );
  if ( NULL_var == Cont )
    return( E_FAIL );

  //----------------------------------------------------------------------
  // Apply rules to modify the path parameters according to the feature
  //----------------------------------------------------------------------
   DNBIInsKWFactory_var
    spIRuleFact( Cont );

  CATIRuleBase_var spIRuleBase = spIRuleFact-&gt;GetRuleBase();
  if( spIRuleBase != NULL_var )
  {
    CATISpecObject_var spISpecPath( pIMPath );
    CATISpecObject_var spISpecFtr( spIFeature );
    spIRuleFact-&gt;AddKWInstance( spISpecFtr );
    spIRuleFact-&gt;AddKWInstance( spISpecPath );
    spIRuleBase-&gt;Solve( 1 );
  }
  else
  {
    DNBIInsFtrPathRules_var spIRules ( pIMPath );
    spIRules-&gt;SetRules();
  }

  //----------------------------------------------------------------------
  // To get the smart pointer to the given path
  // This is done coz the AcquiredFeature takes only the Smart POinter
  //----------------------------------------------------------------------
  DNBIInsMPath_var spIMPath = pIMPath ;
  if( NULL_var == spIMPath )
    return( E_FAIL );
  
  pIMPath-&gt;Release();
  pIMPath = NULL;
  
  DNBIInsFeature   *Feat;
  spIMPath-&gt;GetFeature( Feat );
  
  DNBIInsActivitiesFactory_var ActFact = NULL_var ;
  ActFact = CAADNBInsServices::GetActivityFactory( InsertActivity );

  // Create a MeasureActivity
  if( NULL_var == ActFact )
    return( E_FAIL );
  
  // Create the Measured Feature
  NewOp = ActFact-&gt;Create( InsertActivity, &quot;MeasureSphere&quot;);
  if( NULL == Feat )
    return( E_FAIL );  
  
  CATISPPItemMgt_var spItm ( NewOp );
  if( NULL_var == spItm )
   return( NULL );

  // SetItem for the Sphere feature in the Measure Feature
  spItm-&gt;AddItem( Feat );
  // SetItem for the Path in the Measure Feature
  spItm-&gt;AddItem( spIMPath );
  InsertActivity = NewOp ;

  Feat-&gt;Release();
  Feat = NULL ;
  return( S_OK );
}</pre>
    </td>
  </tr>
</table>
<p>The <code>MeasureSphere</code> method gets the handler to the Sphere feature
which needs to be measured. It&nbsp; creates a path for that and then it applies
rules to it. Finally it creates a MeasureSphere activity and adds it to the
Activity list.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Saving the CATProcess"></a>Saving the Process Document</h4>
<p>The Process document is saved with the name as Experiment.CATProcess. This
method can be found in CAADNBInsServ.cpp.</p>
<table class="code">
  <tr>
    <td>
      <pre>//=============================================================================
//  SaveProcess : This method gets the Current Document and saves the
//                CATProcess
//=============================================================================
HRESULT
CAADNBInsServices::SaveProcess( CATDocument *INSLibDoc )
{
  //----------------------------------------------------------------------
  //   Save the CATProcess
  //----------------------------------------------------------------------

  cout &lt;&lt; endl;
  cout &lt;&lt; &quot;################################################&quot; &lt;&lt; endl;
  cout &lt;&lt; &quot;#    Save the document                         #&quot; &lt;&lt; endl;
  cout &lt;&lt; &quot;################################################&quot; &lt;&lt; endl;
  cout &lt;&lt; endl;

  cout &lt;&lt; &quot;  Saving the process ...&quot;;
  CATIPersistent_var Persistdoc (INSLibDoc);
  if( NULL_var == Persistdoc  )
    return( E_FAIL );
 
  Persistdoc-&gt;SaveAs( &quot;Experiment.CATProcess&quot;,FALSE );
  cout &lt;&lt; &quot;OK&quot; &lt;&lt; endl;
  return( S_OK );
}</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="In Short"></a>In Short</h3>
<p>This use case has demonstrated the way to create a Process document, to add
features, to create activities and finally to measure the activites and to add
the measure activities to the activity list.</p>
<p>The use case:</p>
<ul>
  <li>Creates a Process document</li>
  <li>Creates features and sets their parameters</li>
  <li>Creates activities and adds to the parent activity</li>
  <li>Measures activities and adds the measure activities to the activity list
  <li>Saves the Process document.</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="References"></a>References</h3>
<table width="100%">
  <tr>
    <td>[1]</td>
    <td><a href="../CAADocUseCases/CAADocRunSample.htm">Building
      and Launching a CAA V5 Use Case</a></td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->

<table border="0" width="100%">
  <tr>
    <td colspan="2"><strong><em><a name="History">History</a></em></strong></td>
  </tr>
  <tr>
    <td valign="top">Version: <strong>1</strong> [Mar 2002]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td valign="top" colspan="2">
      <p align="right">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<p><i>Copyright © 2000, Dassault Systèmes. All rights reserved.</i></p>

</body>

</html>
