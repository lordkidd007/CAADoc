<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>UseCase to illustrate the FLEX algorithm </title>
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>Equipment &amp; Systems Engineering</h1>
    </td>
    <td valign="top">
    <td valign="top">
      <h2>Electrical Harness Installation</h2>
    </td>
    <td rowspan="2" align="right" valign="top">
      <h3><a name="Top"></a>UseCase to illustrate the FLEX algorithm</h3>
      <em>UseCase to illustrate the FLEX algorithm</em></td>
  </tr>
  <tr>
    <td class="use" colspan="2">Use Case</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      <p>This article discusses the <i>CAAEhiFLEXComputeBundleSegment </i> use case. This use
      case explains how use APIs on CATIEhiFLEX
      <ul>
        <li><strong><a href="#Learn">What You Will Learn With This Use Case</a></strong></li>
        <li><a href="#UseCase"><strong>The CAAEhiFLEXComputeBundleSegment Use Case</strong></a>
          <ul>
            <li><a href="#What">What Does CAAEhiFLEXComputeBundleSegment Do</a></li>
            <li><a href="#How">How to Launch CAAEhiFLEXComputeBundleSegment </a></li>
            <li><a href="#Where">Where to Find the 
            CAAEhiFLEXComputeBundleSegment  Code</a></li>
          </ul>
        </li>
        <li><a href="#Step"><b>Step-by-Step</b></a></li>
        <li><strong><a href="#InShort">In Short</a></strong></li>
        <li><b><a href="#History">History</a></b></li>
      </ul>
    </td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
<p>This use case is intended to help you to illustrate the FLEX algorithm</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="UseCase"></a>The CAAEhiFLEXComputeBundleSegment Use Case</h3>
<p>CAAEhiFLEXComputeBundleSegment  is a use case of the CAAElecHarnessItf.edu framework
that illustrates the use of the CATIEhiFLEX interface capabilities of 
the ElecHarnessItf framework .</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="What"></a>What Does CAAEhiFLEXComputeBundleSegment  Do</h4>
<p> The goal of CAAEhiFLEXComputeBundleSegment  is to test the CATIEhiFLEX  API on Bundle Segment.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="How"></a>How to Launch CAAEhiFLEXComputeBundleSegment </h4>
<p>To launch CAAEhiFLEXComputeBundleSegment , you will need to set up the build time
environment, then compile CAAEhiFLEXComputeBundleSegment.cpp along with its
prerequisites, set up the run time environment, and then execute the sample.
This is fully described in the referenced article [<a href="#References">1</a>].</p>
<p>To launch the use case, execute the following command:</p>
<pre>mkrun -c &quot;CAAEhiFLEXComputeBundleSegment Input.CATProduct Output.CATProduct &quot;</pre>
<ul>
	<li><b>Input.CATProduct</b> - the path to the existing external CATProduct to 
	be browsed. You may reference the supplied CATProduct document called &quot;SampleProduct.CATProduct&quot; 
	found in:
	<pre><b>InstallRootDirectory</b>\<b>OS</b>\resources\graphic</pre>
	<p>where <b>InstallRootDirectory</b> is the root directory of your CAA V5 installation, 
	and <b>OS</b> is a directory the name of which depends on the operating system. 
	Refer to [<a href="#References">1</a>] to get the list of the currently supported 
	operating systems and their associated directory names.</p>
	</li>
	<li><b>Output.CATProduct</b> - The path where you would like to save the output</li>
</ul>
<p align="center">
<img border="0" src="images/CAAEhiFLEX1.png" width="600" height="500"></p>
<p align="center">
<img border="0" src="images/CAAEhiFLEX2.png" width="600" height="500"></p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Where"></a>Where to Find the <i>CAAEhiFLEXComputeBundleSegment </i> Code</h4>
<p>CAAEhiFLEXComputeBundleSegment  code is located in the 
CAAEhiFLEXComputeBundleSegment.m use case
module of the CAAElecHarnessItf.edu framework:</p>
<table>
  <tr>
    <td>Unix</td>
    <td><code>InstallRootDirectory/CAAElecHarnessItf.edu/CAAEhiFLEXComputeBundleSegment.m/src/CAAEhiFLEXComputeBundleSegment.cpp</code></td>
  </tr>
  <tr>
    <td>Windows</td>
    <td><code>InstallRootDirectory\CAAElecHarnessItf.edu\CAAEhiFLEXComputeBundleSegment.m\src\CAAEhiFLEXComputeBundleSegment.cpp</code></td>
  </tr>
</table>
<p>where <code>InstallRootDirectory</code> is the directory where the CAA CD-ROM 
is installed.</p>
<p>This sample deals with the following classes:</p>
<table>
	<tr>
		<td><i>IUnknown</i></td>
		<td>Base Class for the References and Instances</td>
	</tr>
	<tr>
		<td><i>CATSessionServices</i></td>
		<td>Class for managing the session</td>
	</tr>
	<tr>
		<td><i>CATDocument</i></td>
		<td>Class for the document base class</td>
	</tr>
	<tr>
		<td><i>CATDocumentServices</i></td>
		<td>Class for managing document in the session</td>
	</tr>
	<tr>
		<td><i>CATIDocRoots</i></td>
		<td>Class for browsing root object in document</td>
	</tr>
	<tr>
		<td><i>CATIGSMSpline</i></td>
		<td>Interface allows to access data of the spline feature</td>
	</tr>
	<tr>
		<td><i>CATICkeInst</i></td>
		<td>Interface dedicated to parameters value management</td>
	</tr>
	<tr>
		<td><i>CATIEleDocServices</i></td>
		<td>Interface dedicated electrical environment initialization</td>
	</tr>
	<tr>
		<td><i>CATIElecAttrAccess</i></td>
		<td>Interface dedicated to manage electrical attribute</td>
	</tr>
	<tr>
		<td><i>CATSettingRepository</i></td>
		<td>Interface for managing the user's customization.</td>
	</tr>
	<tr>
		<td><i>CATIEhiBundleSegment</i></td>
		<td>Interface to manage bundle segment.</td>
	</tr>
	<tr>
		<td><i>CATIProduct</i></td>
		<td>Interface to manage products.</td>
	</tr>
	
	
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="Step"></a>Step-by-Step</h3>
<p>We will now first comment the Electrical environment and it&#8217;s components creation 
by looking at the code of the CAAEhiFLEXComputeBundleSegment. There are 7 logical steps in CAAEhiFLEXComputeBundleSegment:</p>
<table width="100%">
	<tr>
		<td><b>#</b></td>
		<td><b>Step</b></td>
	</tr>
	<tr>
		<td valign="top"><a href="#Step1">1</a></td>
		<td valign="top">Creating the session and opening an existing CATProduct</td>
	</tr>
	<tr>
		<td valign="top"><a href="#Step2">2</a></td>
		<td valign="top">Retrieving the root product of the opened document</td>
	</tr>
	<tr>
		<td valign="top"><a href="#Step3">3</a></td>
		<td valign="top">Initializing Electrical Environment</td>
	</tr>
	<tr>
		<td valign="top"><a href="#Step4">4</a></td>
		<td valign="top">Retrieving all geometric bundles under root product </td>
	</tr>
	<tr>
		<td valign="top"><a href="#Step5">5</a></td>
		<td valign="top"> Retrieving all bundle segment under geometrical bundle</td>
	</tr>
	<tr>
		<td valign="top"><a href="#Step6">6</a></td>
		<td valign="top">Calculation of the shape</td>
	</tr>
	<tr>
		<td valign="top"><a href="#Step7">7</a></td>
		<td valign="top">Epilog</td>
	</tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Step1"></a>Creating the session and opening an existing CATProduct</h4>
<p>We need a <i>CATSession</i> pointer to create the Session.</p>
<table class="code">
	<tr>
		<td>
		<pre>...
CATSession *pSession = NULL;
char *sessionName = &quot;CAA_EhiProtection_Session&quot;;
HRESULT rc = ::Create_Session(sessionName,pSession);
...</pre>
		</td>
	</tr>
</table>
<p>We need a CATDocument pointer to opening the document.</p>
<table class="code">
	<tr>
		<td>
		<pre>...
CATDocument *pDoc = NULL;
rc = CATDocumentServices::OpenDocument(argv[1], pDoc);
...</pre>
		</td>
	</tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Step2">Retrieving the root product of the opened document</a></h4>
<p>Retrieving the root product of the opened document <a href="#References"></a>.</p>
<table class="code">
  <tr>
    <td>
      <pre>...
    CATIProduct* piRootProduct = NULL;
    CATIDocRoots * pDocRoots = NULL;
    rc = pDoc-&gt;QueryInterface(IID_CATIDocRoots,(void**) &amp;pDocRoots);
    ...
    CATListValCATBaseUnknown_var* pListRootProduct = pDocRoots-&gt;GiveDocRoots();
    ...
    if  ((NULL != pListRootProduct) &amp;&amp; (0 &lt; pListRootProduct-&gt;Size()))
    {  
      CATBaseUnknown_var spItem1 = ((*pListRootProduct)[1]);
      if (NULL_var != spItem1)
        rc = spItem1-&gt;QueryInterface(IID_CATIProduct,(void**) &amp;piRootProduct );
    }
...</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Step3">Initializing Electrical Environment</a></h4>
<p>To initialize the electrical environment, use the CATIElecDocServices 
interface:</p>
<table class="code">
  <tr>
    <td>
      <pre> CATIEleDocServices * piElecDocServices = NULL;

rc = pDoc-&gt;QueryInterface(IID_CATIEleDocServices,(void**) &amp;piElecDocServices );
</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Step4"></a> Retrieving all geometric bundles under root product  </h4>
<p>Retrieving all geometric bundles under root product </p>
<table class="code">
  <tr>
    <td>
      <pre>...
 CATListValCATBaseUnknown_var* pListGeoBundle = NULL;
    
    pListGeoBundle = piRootProduct-&gt;GetAllChildren(CATIEhiGeoBundle::ClassName());
...
// --- Selecting first geometrical bundle to analyse
  
  CATIEhiGeoBundle * piGeoBundle = NULL;
  CATBaseUnknown_var spGeo1=(*pListGeoBundle)[1];
  rc = spGeo1-&gt;QueryInterface(IID_CATIEhiGeoBundle,(void**) &amp;piGeoBundle);		
...</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
      
<!---------------------------------comment-------------------------------------> 	  
<h4><a name="Step5"></a> Retrieving all bundle segment under geometrical bundle</h4>
<p> Retrieving all bundle segment under geometrical bundle</p>
<table class="code">
  <tr>
    <td>
	<pre>...
	// --- Retrieving all bundle segment under geometrical bundle
  CATListValCATBaseUnknown_var* pListBundleSegment = NULL;
  rc = piGeoBundle-&gt;ListBundleSegments(&amp;pListBundleSegment);
	 //     and the list of his linked support

  CATIEhiBundleSegment * piBundleSegment = NULL;
  int TailleListBundleSegment = pListBundleSegment-&gt;Size() ;
  for(int rank =1 ; rank &lt;=TailleListBundleSegment; rank++)
  {
    CATBaseUnknown_var spCurrent=(*pListBundleSegment)[rank];
    rc = spCurrent-&gt;QueryInterface(IID_CATIEhiBundleSegment,(void**) &amp;piBundleSegment);
    ...
   }
...</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Step6"></a> Calculation of the shape</h4>
<p>Calculation of the shape.</p>
<table class="code">
  <tr>
    <td>
      <pre>...
	CATIInstance *pElecInstance = NULL; 
    if(piBundleSegment&amp;&amp;  SUCCEEDED(piBundleSegment-&gt;QueryInterface(CATIInstance::ClassId(),(void**)&amp;pElecInstance)) &amp;&amp;  pElecInstance )
    {
		
		// 5.1 Retrieving Electrical Curve ( Bundle Segment route )  		
		
		CATIGSMSpline * piSpline = NULL;
		rc = piBundleSegment-&gt;GetElecCurve(&amp;piSpline);
		if ( SUCCEEDED(rc) &amp;&amp; (NULL!=piSpline) )
		{	
			CATIElecAttrAccess * piElecAttr = NULL;
			rc = piSpline-&gt;QueryInterface(IID_CATIElecAttrAccess,(void**) &amp;piElecAttr );
			...
			// We set the Creation Mode to Slack;
			CATUnicodeString attribute,mode;
			mode= &quot;Slack&quot;;
			
			// --- set build mode 
			
			attribute = &quot;Elec_Creation_Mode&quot;;
			rc = piElecAttr->Set(attribute,mode);
			...
			// --- build mode = "Slack" : get slack and set slack to a different value then back to the initial value to mark the curve as Not Uptodate
			if ( mode == &quot;Slack&quot; )
			{
				
				double slack =4.;
				double value =-1;
				CATICkeInst_var hSlack;
				attribute = &quot;Elec_Di_Slack&quot;;
                rc = piElecAttr-&gt;Get(attribute,  hSlack);
                
				//Get the Slack value of the Bundle Segment
				
				if (!!hSlack) value= hSlack-&gt;AsReal();
				...
				//set the Slack Value of the Bundle Segment
				
				rc = piElecAttr-&gt;Set(attribute,slack);
				...
				//Reset the Slack Value to its intial Value
				
				slack=value;
				rc = piElecAttr-&gt;Set(attribute,slack);
				...
			}
			
		// Update the bundle segment 
		
		CATISpecObject_var hSpecBns=piBundleSegment;
			hSpecBns-&gt;Update();

		// Retrieve the Slack value 
		
		CATIValue * pValue = pElecInstance -&gt; GetValue(&quot;Elec_Di_Slack&quot;);
		...
		CATUnicodeString ShowValueSlack = pValue->Show();      
			
		//To retrieve the Minimum Bend Radius
		
		pValue = pElecInstance -&gt; GetValue(&quot;Elec_Min_Bend_Radius&quot;);
			CATUnicodeString ShowValueMinBendRadius = pValue-&gt;Show();      		
  ...</pre>
    </td>
  </tr>
</table>
<p align="center">
<img border="0" src="images/CAAEhiFLEX4.png" width="600" height="500"></p>
<p> To verify the  slack value of the bundle Segment.Therefore retrieve ,set and reset  the Slack value</p>
<p align="right">[<a href="#Top">Top</a>]</p>      
<!---------------------------------comment-------------------------------------> 
<h4><a name="Step7"></a>Epilog</h4>
<table class="code">
  <tr>
    <td>
      <pre>...
  rc = CATDocumentServices::Remove(*pDoc);
...</pre>
    </td>
  </tr>
</table>
<p>To remove the document,&nbsp; use the CATDocumentServices::Remove&nbsp; method. For more
detail on managing documents see [<a href="#References">2</a>].</p>
<table class="code">
  <tr>
    <td>
      <pre>...
rc = ::Delete_Session(sessionName);
...</pre>
    </td>
  </tr>
</table>
<p>The session is deleted before exit.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="InShort"></a>In Short</h3>
<p>This use case is intended to help you to illustrate the FLEX algorithm</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="References"></a>References</h3>
<table width="100%">
	<tr>
		<td valign="top">[1]</td>
		<td>Building and Launching a CAA V5 Use Case</td>
	</tr>
	<tr>
		<td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
	</tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="History"></a>History</h3>
<table width="100%">
	<tr>
		<td valign="top">Version: <strong>1</strong> [January 2014]</td>
		<td valign="top">Document created</td>
	</tr>
	<tr>
		<td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
	</tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<p><i>Copyright © 2014, Dassault Systèmes. All rights reserved.</i></p>
<p>&nbsp;</p>
</body>

</html>


