<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 12.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
<title>Instantiating Combined Curves</title>
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>Mechanical Modeler</h1>
    </td>
    <td valign="top">
      <h2></h2>
    </td>
    <td rowspan="2" align="right" valign="top">
      <h3><a name="Top"></a>Instantiating Combined Curves</h3>
      <em>How to create an instance and store it in a geometrical features
      set?</em></td>
  </tr>
  <tr>
    <td class="use" colspan="2">Use Case</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      <p>This use case explains how to create a V5V6ExtCombinedCurve instance, and
      how to insert it into a geometrical features set [<a href="#References">1</a>].
      <br> This use case is the same as the original CombinedCurve use case, "Instanciating 
		Combined Curves" [<a href="#References">8</a>] rewritten for the new V5V6ExtCombinedCurve Feature. 

      <ul>
        <li><a href="#Learn"><strong>What You Will Learn With This Use Case</strong></a></li>
        <li><a href="#UseCase"><strong>The CAAV5V6ExtMmrCombinedCurve - Instantiation Use Case</strong></a>
          <ul>
            <li><a href="#What">What Does CAAV5V6ExtMmrCombinedCurve - Instantiation Do</a></li>
            <li><a href="#How">How to Launch CAAV5V6ExtMmrCombinedCurve - Instantiation</a></li>
            <li><a href="#Where">Where to Find the CAAV5V6ExtMmrCombinedCurve - Instantiation
              Code</a></li>
          </ul>
        <li><a href="#Step"><strong>Step-by-Step</strong></a></li>
        <li><a href="#InShort"><strong>In Short</strong></a></li>
        <li><a href="#References"><strong>References</strong></a></li>
      </ul>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
<p>The CAAV5V6ExtMmrCombinedCurve - Instantiation use case explains:</p>
<ul>
  <li>How to create a V5V6ExtCombinedCurve instance thanks to <i>CATIV5V6ExtMmrCombinedCurveFactory</i>
    [<a href="#References">2</a>],</li>
  <li>How to recognize the different geometrical features set
    <ul>
      <li>is it a Geometrical Set?</li>
      <li>is it a surfacic set?</li>
      <li>it is an ordered set?</li>
    </ul>
  </li>
  <li>How to create a Geometrical Set
  </li>
  <li>How to insert the new feature into a geometrical features set, in
    particular, into an ordered set [<a href="#References">4</a>]:
    <ul>
      <li>The new instance is located just after the current feature,</li>
      <li>The <code>Insert</code>
    method of the <i>CATMmrLinearBodyServices</i>  class must be called after
    the aggregation.</li>
    </ul>
  </li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="UseCase"></a>The CAAV5V6ExtMmrCombinedCurve - Instantiation Use Case</h3>
<p> CAAV5V6ExtMmrCombinedCurve - Instantiation is a use case of the CAAV5V6MechanicalModeler.edu
framework that illustrates MechanicalModeler capabilities</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="What"></a>What Does CAAV5V6ExtMmrCombinedCurve - Instantiation Do</h4>
<p>The use case shows how to create and insert a V5V6ExtCombinedCurve instance into a
geometrical features set.</p>
<table border="0">
  <tr>
    <td><img border="0" src="../CAAMmrUseCases/images/CAAMmrCombinedCurveInstantiation.jpg" width="339" height="405"></td>
  </tr>
</table>
<p>The yellow Combined Curve is into <code>Geometrical Set.1</code>, the
green Combined Curve is into <code> Ordered Geometrical Set.2</code>, and the
purple Combined
Curve is into <code>Body.1</code>. The thee possible cases for a geometrical
features set.</p>
<p>The use case enables you to select the
type of the aggregating features. Thanks to two environment variables, <code>CAAMmrCombCrvNoHybridBody</code>  and <code>CAAMmrCombCrvOGS, </code> 
you can
aggregate the newly created feature:</p>
<ul>
  <li>Only into a Geometrical Set</li>
  <li>Only into a surfacic features sets: Geometrical Set and Ordered Geometrical
    Set&nbsp;</li>
  <li>Anywhere: into Geometrical Set, Ordered Geometrical Set, and Body features.</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="How"></a>How to Launch CAAV5V6ExtMmrCombinedCurve - Instantiation</h4>
<p>See the section entitled &quot;How to Launch the Combined Curve Use
Case&quot; in the &quot;<a href="CAAV5V6ExtMmrCombinedCurveOverview.htm">Creating
a New Geometrical Feature: The V5V6ExtCombinedCurve</a>&quot; use case for a detailed
description of how this use case should be launched.</p>
<p>There are three kinds of scenarios to consider. Each one enables you to choose
the way to aggregate the new instances:</p>
<ol>
  <li><a href="#You impose the Geometrical Set to aggregate the new instances">You impose the Geometrical Set</a></li>
  <li><a href="#You only accept surfacic bodies ( ordered or not), and you prohibit hybrid bodies">You
    only accept the surfacic sets, and you prohibit Body features</a></li>
  <li><a href="#You accept any kind surfacic body for the new instances">You accept any kind
    of geometrical features set</a></li>
</ol>
<p>Here the scenario are described in detail.</p>
<ol>
  <li><a name="You impose the Geometrical Set to aggregate the new instances"></a>You impose the Geometrical Set</li>
  <p>First, check that&nbsp; two environment variables<code>, CAAMmrCombCrvNoHybridBody</code>  and <code>CAAMmrCombCrvOGS</code> 
  , are not set.</p>
  <p>Launch CATIA, when the application is ready, follow the scenario described
below:</p>
<ul>
    <li>On the <b>File</b> menu click <b>Open</b></li>
  <li>in the <b>File Selection</b> dialog box retrieve the <b>CAAV5V6ExtCombinedCurve.CATPart</b>
    <a href="#(*)">(*)</a> document and click <b>Open</b></li>
  <li>In the <b>Start</b> menu choose&nbsp;<b>Mechanical Design and click Wireframe
    and Surface Design</b></li>
  <li>Create a Combined Curve with the <b>V5V6ExtCombinedCurve</b> 
  <b><img src="../CAAMmrUseCases/images/CAAMmr_I_CombinedCurve.jpg" border="0" width="22" height="22">
    </b>command <a href="#(**)">(**)</a> , it is inserted into an GS</li>
  <li>In the <b>Insert</b> menu choose <b>Ordered Geometrical Set&nbsp;</b>&nbsp;</li>
  <li>Create a Combined Curve with the <b>V5V6ExtCombinedCurve</b>
   <b><img src="../CAAMmrUseCases/images/CAAMmr_I_CombinedCurve.jpg" border="0" width="22" height="22">
    </b>command, it is inserted into a new GS</li>
  <li>In the <b>Start</b> menu choose <b>Mechanical Design </b>and click <b>Part</b>
    <b>Design</b></li>
  <li>In the <b>Insert</b> menu choose <b>Body</b></li>
  <li>Create a Combined Curve with the <b>Combined Curve</b> 
  <b><img src="../CAAMmrUseCases/images/CAAMmr_I_CombinedCurve.jpg" border="0" width="22" height="22">
    </b>command, it is inserted into a new GS</li>
</ul>
  <p>The new combined curve can only be inserted into a Geometrical Set.</p>
  <li><a name="You only accept surfacic bodies ( ordered or not), and you prohibit hybrid bodies"></a>You
    only accept surfacic sets, and you prohibit Body features</li>
<p>First, check that <code>CAAMmrCombCrvOGS</code>  is not set, and export the <code>CAAMmrCombCrvNoHybridBody</code>  environment
variable such as</p>
<ul>
  <li>Unix : <code>export CAAMmrCombCrvNoHybridBody</code>  =whatyouwant
  <li>Windows : <code>set CAAMmrCombCrvNoHybridBody</code>  =whatyouwant</li>
</ul>
<p>Launch CATIA, when the application is ready, follow the scenario described
below:</p>
<ul>
    <li>On the <b>File</b> menu click <b>Open</b></li>
  <li>in the <b>File Selection</b> dialog box retrieve the <b>CAAV5V6ExtCombinedCurve.CATPart</b>
    <a href="#(*)">(*)</a> document and click <b>Open</b></li>
  <li>In the <b>Start</b> menu choose <b>Mechanical Design </b>and click <b>Wireframe
    and Surface</b> <b>Design</b></li>
  <li>Create a Combined Curve with the <b>Combined Curve</b> 
  <b><img src="../CAAMmrUseCases/images/CAAMmr_I_CombinedCurve.jpg" border="0" width="22" height="22">
    </b>command <a href="#(**)">(**)</a> , it is inserted into an GS</li>
  <li>In the <b>Insert</b> menu choose <b>Ordered Geometrical Set&nbsp;</b></li>
  <li>Create a Combined Curve with the <b>Combined Curve</b>
   <b><img src="../CAAMmrUseCases/images/CAAMmr_I_CombinedCurve.jpg" border="0" width="22" height="22">
    </b>command, it is inserted into the current OGS</li>
    <li>In the <b>Start</b> menu choose <b>Mechanical Design </b>and click <b>Part</b>
    <b>Design</b></li>
  <li>In the <b>Insert</b> menu choose <b>Body</b></li>
  <li>Create a Combined Curve with the <b>Combined Curve</b>
   <b><img src="../CAAMmrUseCases/images/CAAMmr_I_CombinedCurve.jpg" border="0" width="22" height="22">
    </b>command, it is inserted into a new GS</li>
    
</ul>
  <p>The new combined curve cannot be inserted into a Body feature.</p>
  <li><a name="You accept any kind surfacic body for the new instances"></a>You accept any kind
    of geometrical features set</li>
  <p>First, export the <code>CAAMmrCombCrvOGS</code> environment variable such as</p>
<ul>
  <li>Unix : <code>export CAAMmrCombCrvOGS</code>=whatyouwant
  <li>Windows : <code>set CAAMmrCombCrvOGS</code>=whatyouwant</li>
  
</ul>
<p>Launch CATIA, when the application is ready, follow the scenario described
below:</p>
<ul>
    <li>On the <b>File</b> menu click <b>Open</b></li>
  <li>in the <b>File Selection</b> dialog box retrieve the <b>CAAV5V6ExtCombinedCurve.CATPart</b>
    <a href="#(*)">(*)</a> document and click <b>Open</b></li>
  <li>In the <b>Start</b> menu choose <b>Mechanical Design </b>and click <b>Wireframe
    and Surface</b> <b>Design</b></li>
  <li>Create a Combined Curve with the <b>V5V6ExtCombined Curve</b> 
  <b><img src="../CAAMmrUseCases/images/CAAMmr_I_CombinedCurve.jpg" border="0" width="22" height="22">
    </b>command <a href="#(**)">(**)</a> , it is inserted into an GS</li>
  <li>In the <b>Insert</b> menu choose <b>Ordered Geometrical Set&nbsp; </b></li>
  <li>Create a Combined Curve with the <b>V5V6ExtCombinedCurve</b> 
  <b><img src="../CAAMmrUseCases/images/CAAMmr_I_CombinedCurve.jpg" border="0" width="22" height="22">
    </b>command, it is inserted into the current OGS</li>
  <li>Create two points with the <b>Point</b> Command into the current OGS</li>
  <li>Create a Combined Curve with the <b>V5V6ExtCombinedCurve</b> 
  <b><img src="../CAAMmrUseCases/images/CAAMmr_I_CombinedCurve.jpg" border="0" width="22" height="22">
    </b>command, it is inserted at the end of the current OGS since the last
    point was the current feature.</li>
  <li>Click right on the first point, and launch <b>Define in Work Object, </b>the
    first point is underlined&nbsp;</li>
  <li>Create a Combined Curve with the <b>V5V6ExtCombinedCurve</b> 
  <b><img src="../CAAMmrUseCases/images/CAAMmr_I_CombinedCurve.jpg" border="0" width="22" height="22">
    </b>command, it is inserted between the two points.</li>
  
    <li>In the <b>Start</b> menu choose <b>Mechanical Design </b>and click <b>Part</b>
    <b>Design</b></li>
  <li>In the <b>Insert</b> menu choose <b>Body</b></li>
  <li>Create a Combined Curve with the <b>V5V6ExtCombinedCurve</b> 
  <b><img src="../CAAMmrUseCases/images/CAAMmr_I_CombinedCurve.jpg" border="0" width="22" height="22">
    </b>command, it is inserted into Body.1</li>
    
   
</ul>
</ol>
<p><a name="(*)">(*)</a> The file is located in the directory <code>CAAV5V6MechanicalModeler.edu/InputData</code></p>
<ul>
  <li>Unix : <code>InstallRootDirectory/CAAV5V6MechanicalModeler.edu/InputData</code>
  <li>Windows : <code>InstallRootDirectory\CAAV5V6MechanicalModeler.edu\InputData</code></li>
</ul>
<p>where <code>InstallRootDirectory</code> is the directory where the CAA CD-ROM
is installed</p>
<p><a name="(**)">(**)</a> To launch the 
<b><img src="../CAAMmrUseCases/images/CAAMmr_I_CombinedCurve.jpg" border="0" width="22" height="22">
</b>command, there are three ways:</p>
<ol>
  <li>In the<b> Tools </b>menu<b> </b>click<b> Customize</b>
    <ul>
      <li>Click the <b>Commands</b> tab</li>
      <li>Click <b>All Commands </b>in the left list&nbsp;</li>
      <li>Retrieve <b>V5V6ExtCombinedCurve</b> in the right list&nbsp;</li>
      <li>Drag and Drop the command in a toolbar.&nbsp;</li>
      <li>Close the <b>Customize</b> Dialog Box</li>
    </ul>
    <li>In the <b>View</b> menu click <b>CommandList</b> and select <b>V5V6ExtCombinedCurve</b> 
      in the&nbsp;list</li>
    <li>Enter <b>c:V5V6ExtCombinedCurve</b> into the power input</li>
</ol>
<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="Where"></a>Where to Find the CAAV5V6ExtMmrCombinedCurve - Instantiation Code</h4>
<p>The CAAV5V6ExtMmrCombinedCurve - Instantiation use case is made one class, <i>CAAV5V6ExtMmrCombCrvPanelStCmd</i>,
located in the CAAV5V6ExtMmrCombinedCurveUI.m module of the CAAV5V6MechanicalModeler.edu
framework:</p>
<table>
  <tbody>
    <tr>
      <td>Windows</td>
      <td><code>InstallRootDirectory\CAAV5V6MechanicalModeler.edu\CAAV5V6ExtMmrCombinedCurveUI.m\</code></td>
    </tr>
    <tr>
      <td>Unix</td>
      <td><code>InstallRootDirectory/CAAV5V6MechanicalModeler.edu/CAAV5V6ExtMmrCombinedCurveUI.m/</code></td>
    </tr>
  </tbody>
</table>
<p>where <code>InstallRootDirectory</code> is the directory where the CAA CD-ROM
is installed.</p>

<p>The use case is an extract of the <i>CAAV5V6ExtMmrCombCrvPanelStCmd</i> class which
is a state command. Refer to the referenced article [<a href="#References">5</a>]
for complete detail about this command.</p>

<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="Step"></a>Step-by-Step</h3>

<p>The CAAV5V6ExtCombinedCurve - Instantiation use case is divided into five steps. The
first three steps are grouped together into the <code>CreateCombinedCurve</code>
method of the <i>CAAV5V6ExtMmrCombCrvPanelStCmd</i>  class (state command). The last two are done once
all the V5V6ExtCombinedCurve inputs are valuated, so at the end of the command, in its
<code>OkAction</code> method.</p>
<ol>
  <li><a href="#Looking for a GSMTool (surfacic body)">Looking for a Geometrical
    Features Set</a></li>
  <li><a href="#Creating the Combined Curve">Creating the V5V6ExtCombinedCurve</a></li>
  <li><a href="#Aggregating the new Combined Curve into the GSMTool">Aggregating the
    new Combined Curve into the Set</a></li>
  <li><a href="#Updating the Feature">Updating the Feature</a></li>
  <li><a href="#Ensuring the Linearity">Ending the aggregation</a></li>
</ol>
<p align="right">[<a href="#Top">Top</a>]</p>
<h4 align="left"><a name="Looking for a GSMTool (surfacic body)">Looking for a Geometrical
Feature Set</a></h4>
<p align="left">It is the first part of the <code>CreateCombinedCurve</code>
method of the <i>CAAV5V6Ext</i></p>
<p align="left">&nbsp;</p>
<p align="left"><i>MmrCombCrvPanelStCmd </i>command<i>.</i> The goal of this
method is to retrieve, or create if necessary, a geometrical features set which
will aggregate the new instance.&nbsp;</p>
<table class="code">
  <tr>
    <td>
      <pre>...     
    CATIGSMTool * piGSMTool = NULL ;

    char * pCombCrvOGS = NULL ;
    CATLibStatus result = ::<b>CATGetEnvValue</b>(&quot;CAAMmrCombCrvOGS&quot;,&amp;pCombCrvOGS);  
    if ( (CATLibError == result) || ( NULL == pCombCrvOGS) )
    {
        char * pCombCrvNoHybridBody = NULL ;
        result = ::<b>CATGetEnvValue</b>(&quot;CAAMmrCombCrvNoHybridBody&quot;,&amp;pCombCrvNoHybridBody); 
        if ( (CATLibError == result) || ( NULL == pCombCrvNoHybridBody) )
        {
           rc = <b><a href="#LookingForGeomSet">LookingForGeomSet</a></b>(&amp;piGSMTool);
        }else
        {
           rc = <b><a href="#LookingForGeomSetOrOrderedGeomSet">LookingForGeomSetOrOrderedGeomSet</a></b>(&amp;piGSMTool);   
        }
    }else
    {
       rc = <b><a href="#LookingForAnyKindOfBody Method">LookingForAnyTypeOfBody</a></b>(&amp;piGSMTool);       
    }</pre>
    </td>
  </tr>
</table>
<p align="left">The environment variables enable
you to choose between three modes:</p>
<ul>
  <li>
    <p align="left">&nbsp;<code>CAAMmrCombCrvOGS</code> and <code>CAAMmrCombCrvNoHybridBody</code>
    are not valuated:</li>
  <p>You have chosen to insert the new instance only within a Geometrical Set.
  The <a href="#LookingForGeomSet"><code>LookingForGeomSet</code></a>
  method will be invoked to looking for, or to create, a Geometrical Set
  feature.&nbsp;</p>
  <li><p align="left">&nbsp;<code>CAAMmrCombCrvOGS</code>  is not valuated, and <code>CAAMmrCombCrvNoHybridBody</code>
    is valuated:</li>
  <p align="left">You have chosen to insert the new instance only within a Geometrical
  Set or an Ordered Geometrical Set. The
  <a href="#LookingForGeomSetOrOrderedGeomSet"><code>LookingForGeomSetOrOrderedGeomSet</code></a>
  method will be invoked to looking for a such set, or to create a Geometrical Set
  feature.&nbsp;&nbsp;</p>
  <li>
    <p align="left"><code>CAAMmrCombCrvOGS</code>  is valuated:</li>
  <p>You have chosen to insert the new instance within any kind of geometrical
  features set. The <a href="#LookingForAnyKindOfBody Method">LookingForAnyTypeOfBody</a><code>
  </code>method will be invoked to looking for a such set, or to create a Geometrical
  Set feature.&nbsp;&nbsp;</p>
</ul>
<p>In the three cases, the geometrical feature set which
will aggregate the new instance is a feature implementing the <i>CATIGSMTool</i>
interface [<a href="#References">1</a>].</p>
<p align="left"><b>The </b><a name="LookingForGeomSet"><b>LookingForGeomSet</b></a><b>
Method</b></p>
<p align="left">The goal of this method is to retrieve or create a Geometrical Set.</p>
      <pre> HRESULT CAAV5V6ExtMmrCombCrvPanelStCmd::<b>LookingForGeomSet</b>(CATIGSMTool ** piGsmtool)
{
...
    <b>CATIMmiUsePrtPart</b> * pIPrtPart = NULL ;
    CATPathElement PathAct = _editor-&gt;<b>GetUIActiveObject</b>();
    rc = PathAct.<b>Search</b>(IID_<b>CATIMmiUsePrtPart</b>,(void**)&amp;pIPrtPart) ;

    if ( SUCCEEDED(rc) &amp;&amp; ( NULL!=pIPrtPart) )
    {
       CATBoolean ToolToCreate = TRUE ;

       <b>CATIBasicTool</b>_var CurrentTool ;
       CurrentTool = pIPrtPart-&gt;<b>GetInWorkObjectTool</b>() ;

       if ( NULL_var != CurrentTool )
       {        
          <b>CATIMmiNonOrderedGeometricalSet</b> * pIGSOnCurrentTool = NULL ;
          rc = CurrentTool-&gt;QueryInterface(IID_CATIMmiNonOrderedGeometricalSet, 
                                            (void**) &amp;pIGSOnCurrentTool);
          if ( SUCCEEDED(rc) )
          {
             ToolToCreate = FALSE ;
             ...
...
       if ( TRUE == ToolToCreate )
       {
          rc = <b><a href="#CreateTool Method">CreateTool</a></b>(pIPrtPart,piGsmtool);
...</pre>
    <p align="left">&nbsp;</p>
<p align="left">The first part consists in retrieving the Part feature of the
current document thanks to the <code>Search</code> method of the <i>CATPathElement</i>
class. This object is within the UI active object path, and implements the <i>CATIMmiUsePrtPart</i>
interface [<a href="#References">6</a>]. The Part feature knows the
current set, you retrieve it thanks to the <code>GetInWorkObjectTool</code> 
method. There is only one case where it is not necessary to create a new
Geometrical Set: the current set is already a Geometrical Set. There are two
means to check that the current set is a Geometrical Set:</p>
<ol>
  <li>
    <p align="left">Check that the current set implements the <i>CATIMmiNonOrderedGeometricalSet</i>
    interface&nbsp;(the methodology currently used)</li>
  <li>
    <p align="left">Check that the current set implements <i>CATIGSMTool</i>,
    and that its <code>GetType</code> method returns <code>0</code>&nbsp;(the
    methodology used in V5R13)</li>
</ol>
<p align="left">The <a href="#CreateTool Method">CreateTool</a> method creates a
new Geometrical Set.</p>
<p align="left"><b>The </b><a name="LookingForGeomSetOrOrderedGeomSet"><b>LookingForGeomSetOrOrderedGeomSet</b></a><b>
Method</b></p>
<p align="left">The goal of this method is to retrieve a surfacic set (ordered
or not), or to create a Geometrical Set.&nbsp;</p>
      <pre>HRESULT CAAV5V6ExtMmrCombCrvPanelStCmd::LookingForGeomSetOrOrderedGeomSet
                                                      (CATIGSMTool ** piGsmtool)
{
...

   <strong>CATIMmiUsePrtPart</strong> * pIPrtPart = NULL ;
   CATPathElement PathAct = _editor-&gt;<b>GetUIActiveObject</b>();
    
   rc = PathAct.<b>Search</b>(IID_CATIMmiUsePrtPart,(void**)&amp;pIPrtPart)  ;

   if ( SUCCEEDED(rc) &amp;&amp; ( NULL!=pIPrtPart) )
   {
       CATBoolean ToolToCreate = TRUE ;  

       <b>CATIBasicTool</b>_var CurrentTool ;
       CurrentTool = pIPrtPart-&gt;<b>GetInWorkObjectTool</b>() ;

       <b>CATIMmiGeometricalSet</b> * pIGSMToolOnCurrentTool = NULL ;
       rc = CurrentTool-&gt;QueryInterface(IID_CATIMmiGeometricalSet, 
                                           (void**) &amp;pIGSMToolOnCurrentTool);
       if ( SUCCEEDED(rc) )
       {             
          ToolToCreate = FALSE ;
          ...
       if ( (TRUE == ToolToCreate) )
       {
          rc = <b><a href="#CreateTool Method">CreateTool</a></b>(pIPrtPart,piGsmtool);
       }
...</pre>
<p align="left">The first part consists in retrieving the Part feature of the
current document thanks to the <code>Search</code> method of the <i>CATPathElement</i>
class. This object is within the UI active object path, and implements the <i>CATIMmiUsePrtPart</i>
interface [<a href="#References">6</a>]. The Part feature knows the
current set, you retrieve it thanks to the <code>GetInWorkObjectTool</code>. The <a href="#CreateTool Method">CreateTool</a> method 
is invoked
only if the current set is a Body feature, it means that the current set does
not implement the <i>CATIMmiGeometricalSet</i>  interface.&nbsp;</p>
<p align="left"><b>The <a name="LookingForAnyKindOfBody Method">LookingForAnyKindOfBody</a>
Method</b></p>
<p align="left">The goal of this method is to retrieve a set implementing the <i>CATIGSMTool</i>
interface<i>,</i> or to create a Geometrical Set. From the V5R14, all the new
geometrical features sets implement <i>CATIGSMTool</i>. The only one case
where a set can do not implement this interface, is the case of the solid set, in other words a
feature instantiated from the MechanicalTool StartUp. It is possible only into a
Part document created before the V5R14.</p>
      <pre>HRESULT CAAV5V6ExtMmrCombCrvPanelStCmd::LookingForGeomSetOrOrderedGeomSet
                               (CATIGSMTool ** piGsmtool)
{
...
   <strong>CATIMmiUsePrtPart</strong> * pIPrtPart = NULL ;
   CATPathElement PathAct = _editor-&gt;<b>GetUIActiveObject</b>();
    
   rc = PathAct.<b>Search</b>(IID_CATIMmiUsePrtPart,(void**)&amp;pIPrtPart)  ;

   if ( SUCCEEDED(rc) &amp;&amp; ( NULL!=pIPrtPart) )
   {
       CATBoolean ToolToCreate = TRUE ;  

       <b>CATIBasicTool</b>_var CurrentTool ;
       CurrentTool = pIPrtPart-&gt;<b>GetInWorkObjectTool</b>() ;

       if ( NULL_var != CurrentTool )
       {         
          <b>CATIGSMTool</b> * pIGSMToolOnCurrentTool = NULL ;
          rc = CurrentTool-&gt;QueryInterface(IID_CATIGSMTool, 
                                      (void**) &amp;pIGSMToolOnCurrentTool);
          if ( SUCCEEDED(rc) )
          {            
              ToolToCreate = FALSE ;
...
       if ( TRUE == ToolToCreate )
       {
          rc = <b>CreateTool</b>(pIPrtPart,piGsmtool);
       }
...</pre>
<p align="left">The first part consists in retrieving the Part feature of the 
current document thanks to the <code>Search</code> method of the <i>CATPathElement</i>
class. This object is within the UI active object path, and implements the <i>CATIMmiUsePrtPart</i>
interface [<a href="#References">6</a>]. The Part feature knows the
current set, you retrieve it thanks to the <code>GetInWorkObjectTool</code>. The <a href="#CreateTool Method">CreateTool</a> method is invoked
only if the current set is a solid body, it means that the current set does
not implement <i>CATIGSMTool</i>.&nbsp;</p>
<p align="left"><b>The <a name="CreateTool Method">CreateTool Method</a></b></p>

      <pre>HRESULT CAAV5V6ExtMmrCombCrvPanelStCmd::CreateTool(CATIPrtPart * pIPrtPart, 
                                                       CATIGSMTool ** pIGsmTool)
{
...
<strong>CATIMmiMechanicalFeature_var</strong> spMechFeatOnMainTool = pIPrtPart;
if (NULL_var != spMechFeatOnMainTool)
{
  //Get container
  <strong>CATIMmiPrtContainer_var</strong> spPrtCont=NULL_var;
  rc = spMechFeatOnMainTool-&gt;<strong>GetPrtContainer</strong>(spPrtCont);
  if (SUCCEEDED(rc) &amp;&amp; spPrtCont!= NULL_var)
  {
#ifdef CATIAR214
...
#else
//============================================== 
// V5 only
//==============================================
      CATIMechanicalRootFactory_var spMechanicalRootFactory = spPrtCont;
      if (spPrtCont != NULL_var)
      {
        CATISpecObject_var spSpecOnGSMTool;
        rc = spMechanicalRootFactory-&gt;CreateGeometricalSet( "", pIPrtPart, spSpecOnGSMTool);
		<strong>CATIMmiMechanicalFeature</strong>_var spGSMTool = spSpecOnGSMTool; 
...
}</pre>
<p align="left">The method to create a Geometrical Set is the <code>CreateGeometricalSet
</code>method of the <i>CATIMechanicalRootFactory</i> interface. This interface
is implemented on the container of specifications, <code>CATPrtCont</code> [<a href="#References">7</a>].
You retrieve it thanks the <code>GetPrtContainer</code> method of the <i>CATIMmiMechanicalFeature</i>
interface implemented on any mechanical feature of the 3D Shape. The Part
feature being useful for the set creation, this feature has been used to
retrieve <code>CATPrtCont</code> .&nbsp;</p>
<p align="left">The argument of the <code>CreateGeometricalSet</code>  method
are:</p>
<ul>
  <li>
    <p align="left">an empty string, to have the default name,</li>
  <li>
    <p align="left"><code>pIPrtPart,</code> a pointer to the Part feature</li>
  <li>
    <p align="left"><code>spiSpecOnGSMTool,</code> the created set</li>
  <li>
    <p align="left">-1 (default argument)&nbsp;</li>
</ul>
<p align="left">It means that the <code>spiSpecOnGSMTool</code> will be inserted
at the end of the Part feature.&nbsp;</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<h4><a name="Creating the Combined Curve">Creating the Combined Curve</a></h4>
<p>The <i>CAAIV5V6EXtMmrCombCrvFactory</i> interface enables us to create an instance
of the V5V6ExtCombinedCurve StartUp.</p>
<pre>...
<strong>CATIMmiMechanicalFeature_var</strong> spMechFeatOnMainTool = piGSMTool;
if (NULL_var != spMechFeatOnMainTool)
{
  //Get container
  <strong>CATIMmiPrtContainer_var</strong> spPrtCont=NULL_var;
  rc = spMechFeatOnMainTool-&gt;<strong>GetPrtContainer</strong>(spPrtCont);
  if (SUCCEEDED(rc) &amp;&amp; spPrtCont!= NULL_var)
  {
    <strong>CAAIV5V6ExtMmrCombCrvFactory </strong>*piCombinedCurveFactory = NULL;
    rc = spPrtCont-&gt;QueryInterface(IID_CAAIV5V6ExtMmrCombCrvFactory , (void**)&amp; piCombinedCurveFactory);
    if (SUCCEEDED(rc))
    {
      // Create the Combined Curve        
      rc = piCombinedCurveFactory-&gt;<strong>CreateCombinedCurve</strong>(_piCurve1, _piDir1, _piCurve2,_piDir2, _piCombinedCurve);

...</pre>
<p><code>piGSMTool</code> is a <i>CATIGSMTool</i> interface pointer on the
geometrical features set, retrieved or created by one of the methods described
just above. See the <a href="#Looking for a GSMTool (surfacic body)">Looking for a Geometrical
    Features Set</a> section.</p>
<p>spMechFeatOnMainTool&nbsp;
is a <i>CATIMmiMechanicalFeature</i> interface smart pointer on this set. Since, the set is a Mechanical feature,
it is included within the <code>CATPrtCont </code>container [<a href="#References">7</a>].&nbsp;So
the <code>GetPrtContainer</code> method retrieves the <code>CATPrtCont</code>
feature which implements the<code> </code><i>CAAIMmrCombCrvFactory</i> interface.</p>
<p>The arguments of the <b><code>CreateCombinedCurve</code></b>  method are data members of
the <i> CAAV5V6ExtMmrCombCrvPanelStCmd</i> state command. They are the four inputs of the
V5V6ExtCombinedCurve to create.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<h4><a name="Aggregating the new Combined Curve into the GSMTool">Aggregating the
new Combined Curve into the Set&nbsp;</a></h4>
<p>The new Combined curve is aggregated into a geometrical features set
thanks to the <i>CATIMmiUseBasicInsertion</i> interface. But depending on the type of the
set, the position of the new instance can be different.&nbsp;</p>
<table class="code">
  <tr>
    <td>
      <pre>...
<strong>CATIMmiUseBasicInsertion_var</strong> hBasicInsertion = _piCombinedCurve; 
if (SUCCEEDED(rc) &amp;&amp; (NULL != piGSMTool) &amp;&amp; (NULL_var != hBasicInsertion))
{ 
  <strong>CATIMmiMechanicalFeature_var</strong> hTarget = piGSMTool;
  if (hTarget != NULL_var)
  {      
    int IsAnOrderedBody= -1 ;
    piGSMTool-&gt;<b>GetType</b>(IsAnOrderedBody);

    if ( <b>1 == IsAnOrderedBody</b>)
    { see <a href="#Aggregation into Ordered Set">Aggregation into Ordered Set</a>} 
    }else
    { see <a href="#Aggregation into Non Ordered Set">Aggregation into Non Ordered Set</a> }
... </pre>
    </td>
  </tr>
</table>
<table class="code">
  <tr>
    <td>
<p>Before the aggregation, check the type of the set using the <i>CATIGSMTool</i>
interface and its <code>GetType</code>
method. <code>1</code> it is an ordered set, <code>0</code>
 otherwise. hBasicInsertion is a <em>CATIMmiUseBasicInsertion</em> smart pointer 
on the geometrical object to aggregate. hTarget is a <i>CATIMmiMechanicalFeature</i>
interface smart pointer on the set (<code>piGSMTool</code>) retrieved or created 
in the <a href="#Looking for a GSMTool (surfacic body)">Looking for a 
Geometrical Features Set</a> section. Theu are used in
<a href="#Aggregation into Ordered Set">Aggregation into Ordered Set</a> and <a href="#Aggregation into Non Ordered Set">
Aggregation into Non Ordered Set</a> sections.</p>
    </td>
  </tr>
</table>
<p><b><a name="Aggregation into Ordered Set"></a>Aggregation into Ordered Set</b></p>
<p>When the set is ordered, the location of the new feature depends on the
current feature. The current feature is:</p>
<ul>
  <li>into the set: the new instance is set after the current feature</li>
  <li>outside the set: the new instance is set at the end of the set.</li>
</ul>
      <pre>...
      CATIMmiMechanicalFeature_var CurrentElt = <strong>GetCurrentFeature</strong>() ;
         
      if (CurrentElt != NULL_var)
      {
        CATIMmiUseBodyContent_var hBodyContent = piGSMTool;
        if (hBodyContent != NULL_var)
        {
          CATListValCATBaseUnknown_var listFeatures;
          hBodyContent-&gt;<strong>GetMechanicalFeatures</strong>(listFeatures);
          if (listFeatures.Locate(CurrentElt))
          {
            // the CC is appended at the end
            hBasicInsertion-&gt;<strong>InsertAfter</strong>(CurrentElt);
          }
          else
          {
            // the current feature is inside the body 
            hBasicInsertion-&gt;<strong>InsertInside</strong>(piGSMTool);
          }
        }
      }
 ...</pre>
<p>The current feature, CurrentElt, is known by the Part feature and its <i>CATIMmiUsePrtPart</i>
interface. But since the <i> CAAMmrCombCrvPanelStCmd</i> derives from the <i>
CATMMUIStateCommand </i>
class<i>,</i> the <code>GetCurrentFeature</code> of this class has been used.&nbsp;</p>
<p> <code>GetMechanicalFeatures</code>, a method&nbsp; of the <i>CATIMmiUseBodyContent</i>
interface, enables us to check if the current feature is in the set or not.&nbsp;</p>
<p> hBasicInsertion is a <i> CATI</i><em>MmiUseBasicInsertion</em> interface 
smart pointer on the new
instance, see the <a href="#Creating the Combined Curve">Creating the Combined Curve</a>
section. It is inserted after the
current feature thanks to the I<code>nsertAfter</code> method, or at the end of the current set
thanks to the InsertInside method, two methods of the <i>CATIMmiUseBasicInsertion</i>
interface.&nbsp;</p>


<p><b><a name="Aggregation into Non Ordered Set"></a>Aggregation into Non
Ordered Set</b></p>
<p>When the set is not ordered,&nbsp; the new instance is always
appended at the end of the set.</p>

      <pre>...
    hBasicInsertion-&gt;<strong>InsertInside</strong>(piGSMTool);
...</pre>
<p> hBasicInsertion is a <i>CATIMmiUseBasicInsertion</i> interface 
smart pointer on the new
instance, see the <a href="#Creating the Combined Curve">Creating the Combined Curve</a>
section. It is inserted at the end of the current set
thanks to the <code>InsertInside</code> method.</p>
   
<p align="right">[<a href="#Top">Top</a>]</p>
<h4><a name="Updating the Feature">Updating the Feature</a></h4>
<p>Once the feature is created and aggregated into a set, you must
update it. In an interactive command, you can use the <i>CATPrtUpdateCom</i>
class to benefit of error management.&nbsp;</p>
<table class="code">
  <tr>
    <td>
<table class="code">
  <tr>
    <td>
      <pre>CATPrtUpdateCom *pUpdateCommand =  new <strong>CATPrtUpdateCom</strong> ( pCombinedCurveObject ,  
                                                        1                    ,  
                                                        GetMode()            ); </pre>
    </td>
  </tr>
</table>
		<br>
    </td>
  </tr>
</table>
<p><code>pCombinedCurveObject</code> is a <i>CAT</i><em>BaseUnknown</em>&nbsp; interface
pointer on the created or modified feature. The second argument, <code>1</code>, enables us
to follow the automatic/manual update of the Part Infrastructure settings. The
last argument specifies the mode of the command, creation or edition. <code>GetMode</code>
is a method of the state command.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<h4><a name="Ensuring the Linearity">Ending the Aggregation&nbsp;</a></h4>
<p>Finally, once the feature is created, aggregated into a set, and updated, if
the set is ordered, you must call the <code>Insert</code> method of the <code>CATIMmiUseLinearBodyServices</code> 
interface.&nbsp;</p>
      <pre>
...
CATBoolean IsInsideOrderedBody = FALSE;
rc = <strong>IsCombCrvInsideOrderedBody</strong>(IsInsideOrderedBody);
if (SUCCEEDED(rc) &amp;&amp; (TRUE == IsInsideOrderedBody))
{
  // Invoke the Insert method is mandatory 
  CATBaseUnknown_var spBUOnCC = pCombinedCurveObject;
      
  <strong>CATIMmiUseLinearBodyServices</strong> *OGSServices = NULL;
  rc = CATMmiUseServicesFactory::<strong>CreateMmiUseLinearBodyServices</strong>(OGSServices);
  if (SUCCEEDED(rc) &amp;&amp; OGSServices)
  {
    rc = OGSServices-&gt;<strong>Insert</strong>(spBUOnCC);      
...
</pre>
<table class="code">
  <tr>
    <td>
      &nbsp;</td>
  </tr>
</table>
<p>The <code>IsCombCrvInsideOrderedBody</code><b> </b>method is a method of the <i>CAAV5V6ExtMmrCombCrvPanelStCmd</i>
class which is detailed in the Editing Combined Curves use case [<a href="#References">5</a>].&nbsp;</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="InShort"></a>In Short</h3>
<p>This use case has explained the methodology to insert a new feature in a
geometrical features set:</p>
<p>This use case has explained the methodology to insert a new feature in a
geometrical features set:</p>
<ol>
  <li>Aggregate the new feature thanks to <i>CATIMmiUseBasicInsertion</i>
    <ul>
      <li>at the end of the set, for a non ordered set ( Geometrical Set)</li>
      <li>After the current feature, otherwise (Body or Ordered Geometrical Set)&nbsp;</li>
    </ul>
  </li>
  <li>Update the new feature thanks to <i>CATPrtUpdateCom</i></li>
  <li>Call the <code>Insert</code> method of the <i>CATIMmiUseLinearBodyServices</i>&nbsp;class
    if the set is ordered</li>
</ol>

<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="References"></a>References</h3>
<table width="100%">
  <tr>
    <td valign="top">[1]</td>
    <td><a href="../CAAMmrTechArticles/CAAMmrContentsSpecCont1.htm">The Contents of the Specification Container-
      Geometrical Features Sets</a>&nbsp;&nbsp;</td>
  </tr>
  <tr>
    <td valign="top">[2]</td>
    <td><a href="CAAV5V6ExtMmrCombinedCurveFactory.htm">Creating V5V6ExtCombinedCurve's
      Factory Interface</a></td>
  </tr>
  <tr>
    <td valign="top">[3]</td>
    <td><a href="../CAAMmrTechArticles/CAAMmrContentsSpecCont2.htm">The
      Contents of the Specification Container - Geometrical Features</a></td>
  </tr>
  <tr>
    <td valign="top">[4]</td>
    <td><a href="../CAAMmrTechArticles/CAAMmrOrderLinearBody.htm">Order
      and Absorption Concepts</a></td>
  </tr>
  <tr>
    <td valign="top">[5]</td>
    <td><a href="CAAV5V6ExtMmrCombCrvEdit.htm">Editing V5V6ExtCombinedCurve Features</a></td>
  </tr>
  <tr>
    <td valign="top">[6]</td>
    <td><a href="../CAAMmrTechArticles/CAAMmrContentsSpecCont1.htm">The Contents of the Specification Container-
      The Part Feature</a>&nbsp;</td>
  </tr>
  <tr>
    <td valign="top">[7]</td>
    <td><a href="../CAAMmrTechArticles/CAAMmrStructurePartDoc.htm">The
      Structure of a Part Document</a></td>
  </tr>
  <tr>
    <td valign="top">[8]</td>
    <td><a href="../CAAMmrUseCases/CAAMmrCombinedCurveInstantiation.htm">
    Instantiating Combined Curves</a></td>
  </tr>

  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="History"></a>History</h3>
<table width="100%">
  <tr>
    <td valign="top">Version: <strong>1</strong>   [Dec 2012]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

</body>

</html>
